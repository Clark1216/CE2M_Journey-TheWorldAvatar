<html>

<head>
    <!-- ===== CUSTOMISABLE ===== -->
    <title>Flood Routing Tool</title>
    <!-- ===== CUSTOMISABLE ===== -->

    <!-- JS -->
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <script
        src="https://cdn.jsdelivr.net/gh/hummingbird-dev/hummingbird-treeview@v3.0.4/hummingbird-treeview.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.0/chartjs-adapter-moment.js"></script>
    <!-- <script src="https://kg.cmclinnovations.com/cdn/dtvf/3.7.0/dtvf.min.js" charset="UTF-8"></script> -->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>


    <!-- ===== CUSTOMISABLE ===== -->

    <!-- CSS -->
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/hummingbird-dev/hummingbird-treeview@v3.0.4/hummingbird-treeview.min.css"
        rel="stylesheet">
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" rel="stylesheet">
    <!-- <link href="https://kg.cmclinnovations.com/cdn/dtvf/3.3.4/dtvf.min.css" rel="stylesheet" /> -->
    <script src="./dtvf.min.js" charset="UTF-8"></script>
    <link href="./dtvf.min.css" rel="stylesheet" />

    <!-- ===== CUSTOMISABLE ===== -->
    <!-- CSS files to provide styling specifically for this visualisation instance can go here. -->
    <link href="./local.css" rel="stylesheet" />

    <style>
        /* Style for the clickable box */
        #toggleRoutesBox {
            background-color: rgba(0, 0, 0, .4);
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 10px;
            line-height: 14pt
        }

        #layerContainer {
            display: flex;
            flex-flow: column;
            overflow: hidden;
        }

        #layerContainer .controlContents {
            display: flex;
            flex-grow: 1;
            overflow: hidden;
        }

        #layerTreeContainer {
            overflow: scroll;
        }

        .distance-container {
            position: fixed;
            /* Use fixed position for the middle of the screen */
            bottom: 30px;
            left: 50%;
            /* Move it to the horizontal center */
            transform: translateX(-50%);
            /* Center it horizontally */
            z-index: 1;
        }

        .distance-container>* {
            background-color: rgba(0, 0, 0, 0.4);
            color: #fff;
            font-size: 13px;
            line-height: 18px;
            display: block;
            margin: 0;
            padding: 5px 10px;
            border-radius: 3px;
        }
    </style>

</head>

<body>
    <!-- Container the map will be added to -->
    <div id="map"></div>

    <!-- ===== CUSTOMISABLE ===== -->
    <!-- JavaScript files to provide functionality specifically for this visualisation instance can go here. -->
    <!-- <script src="./app.js"></script> -->

    <!-- Element for depth of field overlay -->
    <div id="tiltShift"></div>

    <!-- Element the map controls will be added to (normally on the left) -->
    <div id="controlsContainer">
        <div id="controlContainer">

            <!-- Camera controls -->
            <div id="cameraContainer" class="controlBlock">
                <div id="controlTitle" class="controlTitle">
                    <p>Camera</p>
                    <div class="tooltip">
                        <label class="switch"><input type="checkbox"
                                onclick="MapboxUtils.setTiltshift(this.checked)"><span class="slider round">
                                <p>DoF</p></label>
                        <span class="tooltiptext">Toggle depth of field effect</span>
                    </div>
                </div>
                <div class="controlContents">
                    <a href="#" onclick="MapboxUtils.resetCamera()">Reset to default</a><br />
                </div>
            </div>

            <!-- Terrain controls -->
            <div id="terrainContainer" class="controlBlock">
                <div id="controlTitle" class="controlTitle">
                    <p>Imagery</p>
                    <div class="tooltip">
                        <label class="switch"><input type="checkbox"
                                onclick="MapboxUtils.set3DTerrain(this.checked)"><span class="slider round">
                                <p>3D</p></label>
                        <span class="tooltiptext">Toggle 3D terrain</span>
                    </div>
                </div>
                <div id="imageryContainer" class="controlContents">
                </div>
            </div>

            <!-- Layer controls -->
            <div id="layerContainer" class="controlBlock">
                <div id="controlTitle" class="controlTitle">
                    <p>Layers</p>
                    <div class="tooltip" id="placenameContainer">
                        <label class="switch"><input type="checkbox"
                                onclick="MapboxUtils.setPlacenames(this.checked)"><span class="slider round">
                                <p>PNs</p></label>
                        <span class="tooltiptext">Toggle place names, labels, and roads </span>
                    </div>
                </div>
                <div class="controlContents">
                    <div id="layerTreeContainer">
                        <div class="hummingbird-treeview-converter"></div>
                    </div>
                </div>
            </div>

            <!-- Container for the clickable box for routing routes -->
            <div id="routesContainer" class="controlBlock">
                <div id="controlTitle" class="controlTitle">

                    <p>Show Routes</p>

                    <div class="tooltip" id="routeTooltip">
                        <span class="tooltiptext">Different vehicles have different wading capability.</span>
                        <span>?</span>

                    </div>
                </div>
                <div class="controlContents">
                    <div>
                        <input type="checkbox" id="toggleRoutesCheckbox1" checked
                            onclick="MapHandler.MAP.setLayoutProperty('my-layer-10', 'visibility', (this.checked) ? 'visible' : 'none');">
                        <span>10cm Wading Depth</span>
                        <div id="displayValue_10"></div>

                    </div>

                    <div>

                        <input type="checkbox" id="toggleRoutesCheckbox2" checked
                            onclick="MapHandler.MAP.setLayoutProperty('my-layer-30', 'visibility', (this.checked) ? 'visible' : 'none');">
                        <span>30cm Wading Depth</span>
                    </div>

                    <div>

                        <input type="checkbox" id="toggleRoutesCheckbox3" checked
                            onclick="MapHandler.MAP.setLayoutProperty('my-layer-90', 'visibility', (this.checked) ? 'visible' : 'none');">
                        <span>90cm Wading Depth</span>
                    </div>
                </div>

            </div>


            <!-- Help icon -->
            <div id="helpContainer" class="controlBlock expanded" onclick="openHelpURL()">
                <div class="tooltip" id="coordEditor">
                    <i class="fas fa-question fa-lg"></i>
                    <span class="tooltiptext right">Help</span>
                </div>
            </div>

            <!-- Container for developer info -->
            <div id="developerContainer" class="controlBlock" style="display: none;">
                <div class="tooltip" id="coordEditor" style="float: right;">
                    <i class="fas fa-pencil-alt"
                        onclick="event.stopPropagation(); manager.getControlHandler().editInfoPanel()"></i>
                    <span class="tooltiptext">Change map position</span>
                </div>
                <div id="coordsContainer" style="width: 100%; height: 100%;"></div>
            </div>





        </div>
    </div>

    <!-- Distance container to show lengths of routes -->
    <div id="distance" class="distance-container">
        <p>Select start and end points</p>
    </div>

    <!-- Side panel for content and metdata -->
    <div id="sidePanel" class="large expanded">
        <div class="tooltip" id="slideButtonContainer">
            <i class="fas fa-chevron-right" id="slideButton" width="16px" class="leftButton" height="16px"
                onclick="manager.getPanelHandler().toggleExpansion()"></i>
            <span class="tooltiptext">Expand/Collapse</span>
        </div>
        <div class="tooltip" id="expandButtonContainer">
            <i class="fas fa-expand" id="expandButton" width="16px" class="rightButton" height="16px"
                onclick="manager.getPanelHandler().toggleMode()"></i>
            <span class="tooltiptext">Maximise/Minimise</span>
        </div>
        <div id="sidePanelInner">
            <ul>
                <li><a href="#sidePanelGeneral">General</a></li>
                <!-- <li><a href="#sidePanelLegend">Legend</a></li> -->
                <li><a href="#sidePanelLinks">Links</a></li>
            </ul>
            <div id="sidePanelGeneral">
                <div id="titleContainer" onclick="manager.moveMapToFeature()"></div>
                <div id="contentContainer"></div>
                <!-- <div id="legendContainer"></div> -->
                <div id="footerContainer">
                    <div id="footerContent"></div>
                </div>
            </div>
            <!-- <div id="sidePanelLegend"></div> -->
            <div id="sidePanelLinks"></div>
        </div>
        <div id="returnContainer" style="display: none;">
            <div id="innerReturnContainer">
                <a href="#" onclick="manager.getPanelHandler().returnToDefault()"><i class="fas fa-arrow-left"
                        width="16px" height="16px"></i> Return</a>
            </div>
        </div>
    </div>

    <!-- Code entry point -->
    <script>
        $("#sidePanelInner").tabs();

        // ===== CUSTOMISABLE =====
        // Enter Mapbox account name and API key here!
        MapHandler.MAP_USER = "szp20";
        MapHandler.MAP_API = "pk.eyJ1Ijoic3pwMjAiLCJhIjoiY2xmdDlnMWxuMGU4aTNkcGplcWhtZ2lyeCJ9.2v__IHlc2wzlgexRdxfZ8w";
        // ===== CUSTOMISABLE =====
        // Create a new manager instance
        var manager = new Manager(MapProvider.MAPBOX);
        window.manager = manager;

        // Only start the map after data definitions have been read.
        var dataPromise = manager.loadDefinitions();
        dataPromise.then(() => start());
        dataPromise.then(() => getRouteStart())
        dataPromise.then(() => addHospital())

        /**
         * Starts the visualisation setup process.
         */
        function start() {
            // Initialise the map object
            manager.initialiseMap();

            // ===== CUSTOMISABLE =====
            // Set the default content in the "General" tab of the side panel
            manager.getPanelHandler().setTitle("<h1>Flood Routing tool</h1>");
            manager.getPanelHandler().setContent(`
                <p>This desmonstrator visualisation is instantiated in the World Avatar. <br><br>
                    It combines flood, elevation, open road data and population data. Building data has been hidden for this demonstrator but can be enabled in TWA configuration. 
                    <br><br>

                    Drag and drop the pins to view the best available routes between two points in the given flood scenario. Different wading depths represent different vehicle types. Vehicles with deeper water wading capability bight be required to access certain flooded areas. <br><br>

                    Isochrones represent areas of equal travel time from the hospital, and can be used to evaluate what population is unreachable in target time during the flood scenario. Click on the red unreachable population shape to view the number of residents unreachable. <br><br>

                    Asset owners can utilise a similar instantiation to analyse access to their locations in a quickest 'traveling salesman problem' way during a flood. Example used here are synthetically placed power substations. <br><br>

                    Use the layer controls to show/hide various layers. 
                  </p>
                `);

            // Use the local.js file to build the legend
            //buildLegend();

            manager.getPanelHandler().setFooter("The World Avatar, " + new Date().getFullYear());
            // ===== CUSTOMISABLE =====

            // Save general tab state as default
            manager.getPanelHandler().storeDefault();

            // Once the underlying style has loaded...
            MapHandler.MAP.on("style.load", function () {
                // Load registered images and linked files
                manager.loadImagesAndLinks().then(() => {

                    // TODO: This SHOULD only kick in after all images have bee loaded and added to the map,
                    // but I cannot get the nest Promises to wait for each other properly. As it doesn't
                    // seem to be causing any issues, I'm leaving it as is for the time being. - Michael

                    // Plot the default visible data
                    manager.plotData();
                });
            });

        }

        function addHospital() {
            var markerCoordinates = [0.44596810988223834, 52.75684401611818];
            var hospitalIcon = "https://theworldavatar.io/demos/flood-routing/geoserver/www/icons/health-hospital.png";

            // Create a new marker instance with the hospital icon
            var marker = new mapboxgl.Marker({
                element: createHospitalIconElement(hospitalIcon), // Create a custom icon element
                draggable: false
            })
                .setLngLat(markerCoordinates)
                .addTo(MapHandler.MAP);

            // Create the box container
            var boxContainer = document.createElement('div');
            boxContainer.className = 'box-container';
            boxContainer.innerHTML = '<h2>Mapbox JS Div Container Display</h2>' +
                '<p>This is a box displayed as a JS-generated div container on top of the Mapbox map.</p>';
            document.body.appendChild(boxContainer);
        }

        // Function to create a custom hospital icon element
        function createHospitalIconElement(iconUrl) {
            var iconElement = document.createElement('div');
            iconElement.className = 'custom-marker';
            iconElement.style.backgroundImage = 'url(' + iconUrl + ')';
            iconElement.style.backgroundSize = 'cover';
            iconElement.style.width = '30px'; // Set the width and height according to your icon size
            iconElement.style.height = '30px';
            iconElement.style.zIndex = 1; // Set a lower z-index value
            return iconElement;
        }

        function getRouteStart() {

            //Routing functions
            var myLayer_10 = null;
            var myLayer_30 = null;
            var myLayer_90 = null;
            var selectedPoint = null;
            var source = null;
            var target = null;


            // draggable marker for starting point
            var sourceMarker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat([0.44503308060457725, 52.75554119773284])
                .addTo(MapHandler.MAP);
            sourceMarker.getElement().style.zIndex = 999; // Set a high z-index value

            sourceMarker.on("dragend", function (e) {
                console.log('Start Point moved');
                selectedPoint = e.target.getLngLat();
                getVertex(selectedPoint);
                removeLayer();
                getRoute('my-data-90', 'my-layer-90', 'toggleRoutesCheckbox3', '#0B4452', 'routing_workspace:shortest_paths_with_flood_90');
                getRoute('my-data-30', 'my-layer-30', 'toggleRoutesCheckbox2', '#157B3E', 'routing_workspace:shortest_paths_with_flood_30');
                getRoute('my-data-10', 'my-layer-10', 'toggleRoutesCheckbox1', '#e79b3d', 'routing_workspace:shortest_paths_with_flood_10');
                populateDistanceContainer();

            });

            // draggable marker for destination point
            var targetMarker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat([0.43026936435893426, 52.76964201123162])
                .addTo(MapHandler.MAP);
            targetMarker.getElement().style.zIndex = 998; // Set a high z-index value

            targetMarker.on("dragend", function (e) {
                console.log('Endpoint moved');
                selectedPoint = e.target.getLngLat();
                getVertex(selectedPoint);
                removeLayer();
                getRoute('my-data-90', 'my-layer-90', 'toggleRoutesCheckbox3', '#0B4452', 'routing_workspace:shortest_paths_with_flood_90');
                getRoute('my-data-30', 'my-layer-30', 'toggleRoutesCheckbox2', '#157B3E', 'routing_workspace:shortest_paths_with_flood_30');
                getRoute('my-data-10', 'my-layer-10', 'toggleRoutesCheckbox1', '#e79b3d', 'routing_workspace:shortest_paths_with_flood_10');
                populateDistanceContainer();

            });
            // function to get nearest vertex to the passed point
            function getVertex(selectedPoint) {
                var url = `https://theworldavatar.io/demos/flood-routing/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=routing_workspace:routing_ways_vertices_pgr&outputformat=application/json&viewparams=lon:${selectedPoint.lng};lat:${selectedPoint.lat};`;

                $.ajax({
                    url: url,
                    async: false,
                    success: function (data) {
                        loadVertex(
                            data,
                            selectedPoint.toString() === sourceMarker.getLngLat().toString()
                        );
                    }
                });
            }

            // function to update the source and target nodes as returned from geoserver for later querying
            function loadVertex(response, isSource) {
                var features = response.features;
                if (isSource) {
                    source = features[0].properties.id;
                } else {
                    target = features[0].properties.id;
                }
            }


            // // function to get the shortest path from the give source and target nodes
            /*
              function getRoute_10() {
   
                   var url = `https://theworldavatar.io/demos/flood-routing/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=routing_workspace:shortest_paths_with_flood_10&outputformat=application/json&viewparams=source:${source};target:${target};`
   
                   // Retrieve the GeoJSON data from the URL
                   fetch(url)
                       .then(response => response.json())
                       .then(data => {
                           // Add the GeoJSON data as a source
                           MapHandler.MAP.addSource('my-data-10', {
                               type: 'geojson',
                               data: data
                           });
   
                           // Add a layer using the GeoJSON source
                           myLayer_10 = MapHandler.MAP.addLayer({
                               id: 'my-layer-10',
                               type: 'line',
                               source: 'my-data-10',
                               paint: {
                                   'line-color': '#e79b3d',
                                   'line-opacity': 1,
                                   'line-width': 3
                               }
                           });
                           var dataSource = MapHandler.MAP.getSource('my-data-10');
                           const value = document.createElement('pre');
   
                           // Check if the data source exists and contains features
                           if (dataSource && dataSource._data && dataSource._data.features) {
                               var features = dataSource._data.features;
   
                               if (features.length === 0) {
                                   // The data source is empty; there is no possible route
                                   console.log("No possible route.");
                                   // Populate the distanceContainer with no route available
                                   value.textContent = `Area inaccessible`;
                               } else {
                                   // The data source contains features; a route is available
                                   console.log("Length", features.length);
   
                                   // Calculate the total length of the MultiLineString (myLayer_10)
                                   const lineStrings = features.map((feature) => feature.geometry);
                                   const totalLength = lineStrings.reduce((acc, lineString) => {
                                       return acc + turf.length(lineString, { units: 'kilometres' });
                                   }, 0);
   
                                   // Populate the distanceContainer with total distance
                                   value.textContent = `Best available path: ${totalLength.toLocaleString()} km`;
                               }
                           } else {
                               // The data source doesn't exist or has no features
                               console.log("The data source doesn't exist or has no features.");
                                   
                               }
                           distanceContainer.innerHTML = '';
                           distanceContainer.appendChild(value);
   
                           // Get the checkbox element
                           var checkbox = document.getElementById('toggleRoutesCheckbox1');
   
                           // Set layer visibility based on checkbox state
                           if (checkbox.checked) {
                               MapHandler.MAP.setLayoutProperty('my-layer-10', 'visibility', 'visible');
                           } else {
                               MapHandler.MAP.setLayoutProperty('my-layer-10', 'visibility', 'none');
                           }
                       });
               }
   
               function getRoute_30() {
   
                   var url = `https://theworldavatar.io/demos/flood-routing/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=routing_workspace:shortest_paths_with_flood_30&outputformat=application/json&viewparams=source:${source};target:${target};`
                   // Retrieve the GeoJSON data from the URL
                   fetch(url)
                       .then(response => response.json())
                       .then(data => {
                           // Add the GeoJSON data as a source
                           MapHandler.MAP.addSource('my-data-30', {
                               type: 'geojson',
                               data: data
                           });
   
                           // Add a layer using the GeoJSON source
                           myLayer_30 = MapHandler.MAP.addLayer({
                               id: 'my-layer-30',
                               type: 'line',
                               source: 'my-data-30',
                               paint: {
                                   'line-color': '#157B3E',
                                   'line-opacity': 1,
                                   'line-width': 3
                               }
                           });
   
                           // Get the checkbox element
                           var checkbox = document.getElementById('toggleRoutesCheckbox2');
   
                           // Set layer visibility based on checkbox state
                           if (checkbox.checked) {
                               MapHandler.MAP.setLayoutProperty('my-layer-30', 'visibility', 'visible');
                           } else {
                               MapHandler.MAP.setLayoutProperty('my-layer-30', 'visibility', 'none');
                           }
   
                       });
               }
   
               function getRoute_90() {
   
                   var url = `https://theworldavatar.io/demos/flood-routing/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=routing_workspace:shortest_paths_with_flood_90&outputformat=application/json&viewparams=source:${source};target:${target};`
                   // Retrieve the GeoJSON data from the URL
                   fetch(url)
                       .then(response => response.json())
                       .then(data => {
                           // Add the GeoJSON data as a source
                           MapHandler.MAP.addSource('my-data-90', {
                               type: 'geojson',
                               data: data
                           });
   
                           // Add a layer using the GeoJSON source
                           myLayer_90 = MapHandler.MAP.addLayer({
                               id: 'my-layer-90',
                               type: 'line',
                               source: 'my-data-90',
                               paint: {
                                   'line-color': '#0B4452',
                                   'line-opacity': 1,
                                   'line-width': 3
                               }
                           });
   
                           // Get the checkbox element
                           var checkbox = document.getElementById('toggleRoutesCheckbox3');
   
                           // Set layer visibility based on checkbox state
                           if (checkbox.checked) {
                               MapHandler.MAP.setLayoutProperty('my-layer-90', 'visibility', 'visible');
                           } else {
                               MapHandler.MAP.setLayoutProperty('my-layer-90', 'visibility', 'none');
                           }
                       });
               }
   */


            // Global object to store data and layers
            const routeData = {
                'my-data-10': null,
                'my-data-30': null,
                'my-data-90': null,
                'my-layer-10': null,
                'my-layer-30': null,
                'my-layer-90': null,
            };

            function getRoute(sourceName, layerId, checkboxId, lineColour, typeName) {
                var url = `https://theworldavatar.io/demos/flood-routing/geoserver/wfs?service=WFS&version=1.0.0&request=GetFeature&typeName=${typeName}&outputformat=application/json&viewparams=source:${source};target:${target};`

                // Retrieve the GeoJSON data from the URL
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        // Add the GeoJSON data as a source
                        MapHandler.MAP.addSource(sourceName, {
                            type: 'geojson',
                            data: data
                        });

                        // Add a layer using the GeoJSON source and save route data into the dict routeData
                        routeData[sourceName] = data;
                        routeData[layerId] = MapHandler.MAP.addLayer({
                            id: layerId,
                            type: 'line',
                            source: sourceName,
                            paint: {
                                'line-color': lineColour,
                                'line-opacity': 1,
                                'line-width': 3
                            }
                        });
                        // console.log(MapHandler.MAP.getSource(sourceName), 'is', sourceName, 'inside getroute');
                    });

            }

            function populateDistanceContainer() {
                // Populate Distance Container
                const distanceContainer = document.getElementById('distance');
                const value = document.createElement('pre');

                let shortestRoute = {
                    sourceName: '',
                    totalLength: Number.MAX_SAFE_INTEGER, // Initialize to a high value
                    description: '',
                };


                for (const sourceName of ['my-data-10', 'my-data-30', 'my-data-90']) {
                    const data = routeData[sourceName];
                    // console.log(data, data.features, 'is the data source fed into Route Container');
                    if (data && data.features) {
                        // console.log('dataSource from', sourceName, 'is truthy :)', data)
                        const features = data.features;
                        const lineStrings = features.map((feature) => feature.geometry);
                        const totalLength = lineStrings.reduce((acc, lineString) => {
                            return acc + turf.length(lineString, { units: 'kilometres' });
                        }, 0);
                        console.log(totalLength)
                        if (0 < totalLength < shortestRoute.totalLength) {
                            shortestRoute.sourceName = sourceName;
                            shortestRoute.totalLength = totalLength;
                        }
                    }
                }

                if (shortestRoute.totalLength !== Number.MAX_SAFE_INTEGER) {
                    if (shortestRoute.sourceName === 'my-data-10' && shortestRoute.totalLength !== 0) {
                        console.log("10cm route available");
                        shortestRoute.description = `Best available route: ${shortestRoute.totalLength.toLocaleString()} km, by any vehicle`;
                    } else if (shortestRoute.sourceName === 'my-data-30' && shortestRoute.totalLength !== 0) {
                        console.log("30cm route available");
                        shortestRoute.description = `Best available route: ${shortestRoute.totalLength.toLocaleString()} km, by vehicle with medium wading depth`;
                    } else if (shortestRoute.sourceName === 'my-data-90' && shortestRoute.totalLength !== 0) {
                        console.log("90cm route available");
                        shortestRoute.description = `Best available route: ${shortestRoute.totalLength.toLocaleString()} km, by vehicle with deep wading depth`;
                    }
                } else {
                    // No route available
                    console.log("No possible route.");
                    shortestRoute.description = `Area inaccessible`;
                }

                // Populate the distanceContainer with the shortest route
                value.textContent = shortestRoute.description;
                distanceContainer.innerHTML = '';
                distanceContainer.appendChild(value);
            }

            /*
            function populateDistanceContainer(sourceName) {
                // Populate Distance Container
                const distanceContainer = document.getElementById('distance');
                const value = document.createElement('pre');
                var dataSource = MapHandler.MAP.getSource(sourceName);
                var features = dataSource._data.features;

                if (dataSource._data && dataSource._data.features && dataSource._data.features.length !== 0) {
                    // Calculate the total length of the MultiLineString (lineLayer)
                    const lineStrings = features.map((feature) => feature.geometry);
                    const totalLength = lineStrings.reduce((acc, lineString) => {
                        return acc + turf.length(lineString, { units: 'kilometres' });
                    }, 0);
                    if (sourcename = 'my-data-10' && features.length !== 0) {
                        console.log("10cm route available");
                        // Populate the distanceContainer with total distance
                        value.textContent = `Best available route: ${totalLength.toLocaleString()} km, by any vehicle`;
                    }


                    else if (sourcename = 'my-data-30' && features.length !== 0) {


                        console.log("30cm route available");
                        value.textContent = `Best available route: ${totalLength.toLocaleString()} km, by vehicle with medium wading depth`;

                    }

                    else if (sourcename = 'my-data-90' && features.length !== 0) {

                        console.log("90cm route available");

                        value.textContent = `Best available route: ${totalLength.toLocaleString()} km, by vehicle with deep wading depth`;

                    }

                    // 
                    else if (sourcename = 'my-data-90' && dataSource.length === 0) {
                        // The data source is empty; there is no possible route
                        console.log("No possible route.");
                        // Populate the distanceContainer with no route available
                        value.textContent = `Area inaccessible`;
                    }
                }

                else {
                    // The data source doesn't exist or has no features
                    console.log("The data source doesn't exist or has no features.");

                }

                distanceContainer.innerHTML = '';
                distanceContainer.appendChild(value);


                // Get the checkbox element
                var checkbox = document.getElementById(checkboxId);

                // Set layer visibility based on checkbox state
                if (checkbox.checked) {
                    MapHandler.MAP.setLayoutProperty(layerId, 'visibility', 'visible');
                } else {
                    MapHandler.MAP.setLayoutProperty(layerId, 'visibility', 'none');
                }
            }
*/
            // function to remove the layer
            function removeLayer() {
                // Remove layers and sources and set variables to null
                if (MapHandler.MAP.getLayer('my-layer-90') != null) {
                    MapHandler.MAP.removeLayer('my-layer-90');
                    MapHandler.MAP.removeSource('my-data-90');
                    myLayer_90 = null;
                }
                if (MapHandler.MAP.getLayer('my-layer-30') != null) {
                    MapHandler.MAP.removeLayer('my-layer-30');
                    MapHandler.MAP.removeSource('my-data-30');
                    myLayer_30 = null;
                }
                if (MapHandler.MAP.getLayer('my-layer-10') != null) {
                    MapHandler.MAP.removeLayer('my-layer-10');
                    MapHandler.MAP.removeSource('my-data-10');
                    myLayer_10 = null;
                };

                const routeData = {
                    'my-data-10': null,
                    'my-data-30': null,
                    'my-data-90': null,
                    'my-layer-10': null,
                    'my-layer-30': null,
                    'my-layer-90': null,
                };
            }



            //To get initial route
            getVertex(sourceMarker.getLngLat());
            getVertex(targetMarker.getLngLat());
            removeLayer();
            console.log(MapHandler.MAP.getLayer('my-layer-10'));
            //getRoute_10();
            getRoute('my-data-10', 'my-layer-10', 'toggleRoutesCheckbox1', '#e79b3d', 'routing_workspace:shortest_paths_with_flood_10');
            getRoute('my-data-30', 'my-layer-30', 'toggleRoutesCheckbox2', '#157B3E', 'routing_workspace:shortest_paths_with_flood_30');
            getRoute('my-data-90', 'my-layer-90', 'toggleRoutesCheckbox3', '#0B4452', 'routing_workspace:shortest_paths_with_flood_90');
            //            getRoute_30();
            //          getRoute_90();


        }



    </script>


</body>

</html>

</html>
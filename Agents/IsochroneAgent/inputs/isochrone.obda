[PrefixDeclaration]
xsd:    http://www.w3.org/2001/XMLSchema#
bot:    https://w3id.org/bot#
obe: 	https://www.theworldavatar.com/kg/ontobuiltenv/
iso:    https://www.theworldavatar.com/kg/ontoisochrone/
geo:    http://www.opengis.net/ont/geosparql#

[MappingDeclaration] @collection [[
mappingId	usage
target		<{building_iri}> a bot:Building ;
                obe:hasPropertyUsage <{propertyusage_iri}> ;
                obe:hasFootprint {geometry}^^xsd:string.
            <{propertyusage_iri}> a obe:{ontobuilt} ;
                obe:hasUsageShare {usageshare}^^xsd:float ;
                obe:hasUsageLabel {name}^^xsd:string .
source      SELECT DISTINCT
                COALESCE(p.name, o.name) AS name,
                u.building_iri,
                u.ontobuilt,
                u.propertyusage_iri,
                u.usageshare,
                ST_Transform(sg.geometry, 4326) AS geometry
            FROM
                usage.usage AS u 
            LEFT JOIN
                osm.points AS p ON u.building_iri = p.building_iri
            LEFT JOIN
                osm.polygons AS o ON u.building_iri = o.building_iri
            LEFT JOIN
                citydb.cityobject_genericattrib AS cga ON u.building_iri = cga.urival
            LEFT JOIN 
                citydb.building AS b ON b.id = cga.cityobject_id -- Fix the syntax here
            LEFT JOIN
                citydb.surface_geometry sg ON b.lod0_footprint_id = sg.id


mappingId	isochrone_transport
target		<{isochrone_iri}> a iso:Isochrone ;
                iso:calculatedUsing {transportmode}^^xsd:string;
                iso:hasTimeThreshold {minute}^^xsd:integer;
                geo:hasGeometry <{geometry_iri}>.
            <{geometry_iri}> a geo:Geometry;
                geo:asWKT {geom}^^xsd:string.
source      SELECT minute, transportmode, poi_type, isochrone_iri, geometry_iri, ST_AsText(ST_Force2D(geom)) as geom  FROM isochrone_aggregated

mappingId	isochrone_building
target		<{isochrone_iri}> a iso:Isochrone ;
                iso:originatedFrom <{poi_iri}>.
            <{poi_iri}> a <{poi_type}>
source      SELECT isochrone_iri, poi_iri, poi_type FROM isochrone_building_ref
]]
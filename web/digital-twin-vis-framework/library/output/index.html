<html>
    <head>
        <!-- TODO: Change this if desired -->
        <title>DTVF v2.0.0</title>

        <!-- JS -->
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

        <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js'></script>
        <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
        <script src="https://cdn.jsdelivr.net/gh/hummingbird-dev/hummingbird-treeview@v3.0.4/hummingbird-treeview.js"></script>
        <script src="./dtvf.temp.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.0/chartjs-adapter-moment.js"></script>

        <!-- CSS -->
        <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/gh/hummingbird-dev/hummingbird-treeview@v3.0.4/hummingbird-treeview.min.css" rel="stylesheet">
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" rel="stylesheet">
        <link href="./dtvf.min.css" rel="stylesheet" />
        <link href="./controls.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Container the map will be added to -->
        <div id="map"></div>

        <!-- Element for depth of field overlay -->
        <div id="tiltShift"></div>

        <!-- Element the map controls will be added to (normally on the left) -->
        <div id="controlsContainer">
            <div id="controlContainer">

                <!-- Camera controls -->
                <div id="cameraContainer" class="controlBlock">
                    <div id="controlTitle" class="controlTitle">
                        <p>Camera</p>
                        <div class="tooltip">
                            <label class="switch"><input type="checkbox" onclick="MapBoxUtils.setTiltshift(this.checked)"><span class="slider round"><p>DoF</p></label>
                            <span class="tooltiptext">Toggle depth of field effect</span>
                        </div>
                    </div>
                    <div class="controlContents">
                        <a href="#" onclick="MapBoxUtils.changeCamera('bird')">Bird's Eye</a><br/>
                        <a href="#" onclick="MapBoxUtils.changeCamera('pitch')">Pitched</a>
                    </div>
                </div>

                <!-- Terrain controls -->
                <div id="terrainContainer" class="controlBlock">
                    <div id="controlTitle" class="controlTitle">
                        <p>Terrain</p>
                        <div class="tooltip">
                            <label class="switch"><input type="checkbox" onclick="MapBoxUtils.set3DTerrain(this.checked)"><span class="slider round"><p>3D</p></label>
                            <span class="tooltiptext">Toggle 3D terrain</span>
                        </div>
                    </div>
                    <div class="controlContents">
                        <input type="radio" name="terrain" id="light" onclick="MapBoxUtils.changeTerrain('light')" checked>
                        <label for="light">Light</label><br/>
                        <input type="radio" name="terrain" id="dark" onclick="MapBoxUtils.changeTerrain('dark')">
                        <label for="dark">Dark</label><br/>
                        <input type="radio" name="terrain" id="outdoors" onclick="MapBoxUtils.changeTerrain('outdoors')">
                        <label for="outdoors">Outdoors</label><br/>
                        <input type="radio" name="terrain" id="satellite" onclick="MapBoxUtils.changeTerrain('satellite')">
                        <label for="satellite">Satellite</label><br/>
                    </div>
                </div>

                <!-- Layer controls -->
                <div id="layerContainer" class="controlBlock">
                    <div id="controlTitle"  class="controlTitle">
                        <p>Layers</p>
                        <div class="tooltip" id="placenameContainer">
                            <label class="switch"><input type="checkbox" onclick="MapBoxUtils.setPlacenames(this.checked)" checked><span class="slider round"><p>PNs</p></label>
                            <span class="tooltiptext">Toggle place names, labels, and roads </span>
                        </div>
                    </div>
                    <div class="controlContents">
                        <div id="layerTreeContainer">
                            <div class="hummingbird-treeview-converter"></div>
                        </div>
                    </div>
                </div>

                <!-- Container for developer info -->
                <div id="developerContainer" class="controlBlock" style="display: none;">
                    <div class="tooltip" id="coordEditor" style="float: right;">
                        <i class="fas fa-pencil-alt" onclick="manager.editInfoPanel()"></i>
                        <span class="tooltiptext">Change map position</span>
                    </div>
                    <div id="coordsContainer" style="width: 100%; height: 100%;"></div>
                </div>
            </div>
        </div>

        <!-- Side panel for content and metdata -->
        <div id="sidePanel" class="large expanded">
            <div class="tooltip" id="slideButtonContainer">
                <i class="fas fa-chevron-right" id="slideButton" width="16px" class="leftButton" height="16px" onclick="manager.getPanelHandler().toggleExpansion()"></i>
                <span class="tooltiptext">Expand/Collapse</span>
            </div>
            <div class="tooltip" id="expandButtonContainer">
                <i class="fas fa-expand" id="expandButton" width="16px" class="rightButton" height="16px" onclick="manager.getPanelHandler().toggleMode()"></i>
                <span class="tooltiptext">Maximise/Minimise</span>
            </div>
            <div id="sidePanelInner">
                <ul>
                    <li><a href="#sidePanelGeneral">General</a></li>
                    <li><a href="#sidePanelLegend">Legend</a></li>
                    <li><a href="#sidePanelLinks">Links</a></li>
                </ul>
                <div id="sidePanelGeneral">
                    <div id="titleContainer"></div>
                    <div id="contentContainer"></div>
                    <div id="legendContainer"></div>
                    <div id="footerContainer">
                        <div id="returnContainer">
                            <a href="#" onclick="manager.goToDefaultPanel()">&lt; Return</a>
                        </div>
                        <div id="footerContent"></div>
                    </div>
                </div>
                <div id="sidePanelLegend"></div>
                <div id="sidePanelLinks"></div>
            </div>
        </div>

        <!-- Code entry point -->
        <script>
            $("#sidePanelInner").tabs();

            // Create a new manager instance
            MapHandler.MAP_API = "pk.eyJ1IjoibWhpbGxtYW4iLCJhIjoiY2t1NW5wMDF3MnBzaDJ2cWhyZ2MxbHh4diJ9.TPv5CXdhGvFPkL28tTeXTA";
            var manager = new Manager(MapProvider.MAPBOX);

            // Load the definitions of sample data
            // TODO: Add endpoint base URLs here.
            var dataPromise = manager.loadDefinitions([
                "./test-data-1"
            ]);
            
             // Only start the map after data definitions have been read.
            dataPromise.then(() => start());

            /**
             * 
             */
            function start() {
                // Override default map options
                // TODO: Override default map options here
                let optionsOverride = {
                    "center": [0.121971, 52.205253],
                    "zoom": 14,
                    "bearing": 0,
                    "pitch": 45,
                    "style": "mapbox://styles/mapbox/light-v10?optimize=true"
                };

                // Initialise the map object
                manager.initialiseMap(optionsOverride);
                
                // Set default side panel content
                // TODO: Change these as desired.
                manager.getPanelHandler().setTitle("<h1>Example Visualisation</h1>");
                manager.getPanelHandler().setContent(`
                    <p style="font-weight: bold;">Here's some sample introduction text, pulled from nowhere in particular.</p>
                    <p>"Did you ever hear the Tragedy of Darth Plagueis the wise? I thought not. It's not a story the Jedi 
                    would tell you. It's a Sith legend. Darth Plagueis was a Dark Lord of the Sith, so powerful and so wise 
                    he could use the Force to influence the midichlorians to create life...</p>
                    <p>He had such a knowledge of the dark side that he could even keep the ones he cared about from dying. 
                    The dark side of the Force is a pathway to many abilities some consider to be unnatural. He became so powerful... 
                    the only thing he was afraid of was losing his power, which eventually, of course, he did. Unfortunately, he 
                    taught his apprentice everything he knew, then his apprentice killed him in his sleep. It's ironic he could 
                    save others from death, but not himself."</p>
                `);
                manager.getPanelHandler().toggleLegend(false);
                manager.getPanelHandler().setFooter("CMCL Innovations Â© " + new Date().getFullYear());

                // Save panel state as default
                manager.getPanelHandler().storeDefault();

                // Once the underlying style has loaded...
                MapHandler.MAP.on("style.load", function() {

                    // Load registered images and linked files
                    manager.loadImagesAndLinks().then(() => {

                        // Plot the default visible data
                        manager.plotData();
                    });
                });
            }
          
        </script>
    </body>
</html>
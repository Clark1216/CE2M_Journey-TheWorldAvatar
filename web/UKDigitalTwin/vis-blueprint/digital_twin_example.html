<!DOCTYPE html>
<html>

<head>
	<title>Digital Twin Example</title>
	<meta charset="utf-8">

	<!-- External JS and CSS, needs to be declared FIRST -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css' rel='stylesheet' />

	<!-- JS and CSS for Digital Twin framework -->
	<!-- Local CSS -->
	<link href='digital_twin_style.css' rel='stylesheet' />

	<!-- Core functionality -->
	<script src='digital_twin_manager.js'></script>
	<script src='digital_twin_module.js'></script>

	<!-- Control handlers -->
	<script src='digital_twin_controls.js'></script>
	<script src='digital_twin_tree.js'></script>
	<script src="digital_twin_side_panel.js"></script>

	<!-- Visualisation specific JS and CSS -->
	<!-- ADD HERE IF REQUIRED -->
</head>

<body>
	<!-- Element the MapBox map will be added to -->
	<div id='map'></div>
	
	<!-- Element the map controls will be added to -->
	<div id="controlsParent"></div>

	<!-- Non-module JS block, variable in here are global-->
	<script>
		let manager = null;
	</script>

	<!-- Module JS block, variables are local (i.e. cannot access from HTML) -->
	<script type="module">
		// Module imports
		import { CambridgeshirePointsModule } from "./example/cambridgeshire-points.js";
		import { CambridgeshireRegionModule } from "./example/cambridgeshire-regions.js";

		// Initialise a controller (store as global variable)
		manager = new DigitalTwinManager();

		// Create the map
		let map = manager.createMap(
			"map", 
			"pk.eyJ1Ijoiam1hcnNkZW4iLCJhIjoiY2ttZzNqM3IxM2JyYzJ2bndzZnIxeG1lciJ9.uwb9ZnBO3vWssvcBsXcFeA",
			[0.15282, 52.32136],
			9
		);

		// Build the layer tree
		manager.buildControls("./example/layer-tree.json");
		
		// Add modules to the controller
		let cambRegionModule = new CambridgeshireRegionModule();
		manager.addModule(cambRegionModule);

		let cambPointsModule = new CambridgeshirePointsModule();
		manager.addModule(cambPointsModule);

		// Provide some default content for the side panel
		DT.sideHandler.setTitle("Default Title");

		var defaultContent = `
			<div style="height: 100%; border: 1px solid grey;">
				<p>Here is some introductory text, this should be used to detail the overall purpose of the
				visualisation, and perhaps tell the user how they can interact with it.</p>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin ut magna sed velit dictum varius.
				Vestibulum magna orci, pulvinar eget quam ut, vestibulum pretium justo. Vivamus ut dignissim sem.</p>
				<p>Quisque ut cursus dolor. Fusce vel dui luctus dolor dapibus porttitor. Vestibulum pharetra tortor dolor,
				sit amet varius ex rhoncus convallis. Donec commodo bibendum ligula eget vulputate. Cras a velit suscipit,
				vulputate est sodales, vulputate dui.</p>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin ut magna sed velit dictum varius.
				Vestibulum magna orci, pulvinar eget quam ut, vestibulum pretium justo. Vivamus ut dignissim sem.</p>
				<p>Quisque ut cursus dolor. Fusce vel dui luctus dolor dapibus porttitor. Vestibulum pharetra tortor dolor,
				sit amet varius ex rhoncus convallis. Donec commodo bibendum ligula eget vulputate. Cras a velit suscipit,
				vulputate est sodales, vulputate dui.</p>
			</div>`;
		DT.sideHandler.setContent(defaultContent);

		DT.sideHandler.setLegend(`
			<div style="border: 1px solid grey;">
				<br><br>
				<p>This area is designed to hold a number of legends. Each layer (as shown to 
				the user in the layer tree) should have its own legend to explain the data
				on the map. This could be dynamically generated HTML, or an image file.</p>
				<br><br>
			</div>
		`);

		DT.sideHandler.setFooter(`
			<div style="border: 1px solid grey;">
				Here is some footer content.
			</div>
		`);

		// Fire on MapBox style change
		map.on('style.load', function() {
			console.log("INFO: A new style has been loaded.");

			// Load all modules
			manager.loadModules();
		});
	</script>

</body>

</html>
<!DOCTYPE html>
<html>

<head>
	<title>Digital Twin Example</title>
	<meta charset="utf-8">

	<!-- External JS and CSS -->
	<!-- Needs to be declared BEFORE other libraries -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js'></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css' rel='stylesheet' />

	<!-- Remote CMCL JS files for DEVELOPMENT -->
	<!-- Needs to be declared BEFORE local libraries -->
	
	<!--
		<script src='http://kg.cmclinnovations.com:81/user/themes/quark/js/mapbox-controls.js'></script>
		<script src='http://kg.cmclinnovations.com:81/user/themes/quark/js/side-panel.js'></script>
	-->

	<!-- Remote CMCL CSS files for DEVELOPMENT -->
	<!-- 
		<link href='http://kg.cmclinnovations.com:81/user/themes/quark/css/mapbox-controls.css' rel='stylesheet' />
		<link href='http://kg.cmclinnovations.com:81/user/themes/quark/css/side-panel.css' rel='stylesheet' />
	-->

	<!-- Local JS and CSS -->
	
	<link href='digital_twin_style.css' rel='stylesheet' />
	<script src='digital_twin_manager.js'></script>
	<script src='digital_twin_module.js'></script>
	<script src='digital_twin_controls.js'></script>
	<script src='digital_twin_tree.js'></script>
</head>

<body>
	<!-- Element the MapBox map will be added to -->
	<div id='map'></div>
	
	<!-- Element the map controls will be added to -->
	<div id="controlsParent"></div>

	<!-- Non-module JS block, variable in here are global-->
	<script>
		let manager = null;
	</script>

	<!-- Module JS blcok, variables are local (i.e. cannot access from HTML) -->
	<script type="module">
		// Module imports
		import { CambridgeshirePointsModule } from "./example/cambridgeshire-points.js";
		import { CambridgeshireRegionModule } from "./example/cambridgeshire-regions.js";

		// Initialise a controller (store as global variable)
		manager = new DigitalTwinManager();

		// Create the map
		let map = manager.createMap(
			"map", 
			"pk.eyJ1Ijoiam1hcnNkZW4iLCJhIjoiY2ttZzNqM3IxM2JyYzJ2bndzZnIxeG1lciJ9.uwb9ZnBO3vWssvcBsXcFeA",
			[0.15282, 52.32136],
			9
		);

		// Build the layer tree
		manager.buildControls("./example/layer-tree.json");
		
		// Add modules to the controller
		let cambPointsModule = new CambridgeshirePointsModule();
		manager.addModule(cambPointsModule);

		let cambRegionModule = new CambridgeshireRegionModule();
		manager.addModule(cambRegionModule);

		// Fire on MapBox style change
		map.on('style.load', function() {
			console.log("INFO: A new style has been loaded.");

			// Load all modules
			manager.loadModules();
		});
	</script>

</body>

</html>
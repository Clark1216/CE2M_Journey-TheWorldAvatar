<!DOCTYPE html>
<html>

<head>
    <title>Power System Visualisation</title>
    <meta charset="utf-8">

    <!-- Javascript -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js"></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src='http://kg.cmclinnovations.com:81/user/themes/quark/js/checktree.js'></script>
    <script src='http://kg.cmclinnovations.com:81/user/themes/quark/js/mapbox-controls.js'></script>
    <script src='http://kg.cmclinnovations.com:81/user/themes/quark/js/side-panel.js'></script>
    <!--<script src="https://cdn.bootcss.com/Turf.js/5.1.6/turf.min.js"></script>-->
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <script src='power-system.js'></script>

    <!-- Stylesheets -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css' rel='stylesheet'>
    <link href='http://kg.cmclinnovations.com:81/user/themes/quark/css/mapbox-controls.css' rel='stylesheet' />
    <link href='http://kg.cmclinnovations.com:81/user/themes/quark/css/side-panel.css' rel='stylesheet' />
    <!--<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin="" />-->
    <link href='style.css' rel='stylesheet' />

</head>

<body>

    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

    <!-- div is a DOM element -->
    <div id='map'></div> <!-- container of map -->
    <div id="tiltShift"></div>
    <div id="controlsParent"></div>

    <script>
        // The getControls() is invoked from the mapbox-controls.js for returning a controlHTML containing camera, terrain, and layer panels
        document.getElementById("controlsParent").innerHTML = getControls();

        // Initial state of side-panel (from side-panel.js)
        initialiseSidePanel(document.getElementById("map"));

        // Reset side panel (from power-system.js)
        resetSidePanel();

        // Show loading icon whilst stuff spins up
        var loadingHTML = `
                <br><br><br><br><br>
                <img width='150' src='loading.gif'></img>
                <br>
                <span style='color: grey; font-style: italic;'>Loading data, please wait...</span>
            `;
        appendSidePanelText(loadingHTML);

        // Initialise the MapBox map
        mapboxgl.accessToken = 'pk.eyJ1Ijoiam1hcnNkZW4iLCJhIjoiY2ttZzNqM3IxM2JyYzJ2bndzZnIxeG1lciJ9.uwb9ZnBO3vWssvcBsXcFeA';
        var map = new mapboxgl.Map(getDefaultMapOptions());

        // Initialise MapBox popup for mouse-overs
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });

        // Change some layer colors depending on selected style
        var inner_text = '#3E3E3E';
        var outer_text = '#FFFFFF';

        // Triggers after terrain change
        function terrainCallback(terrainType) {
            if (terrainType === "light") {
                inner_text = '#3E3E3E';
                outer_text = '#FFFFFF';
            } else {
                inner_text = '#FFFFFF';
                outer_text = '#000000';
            }
        }

        // Triggers after camera change
        function cameraCallback() {
            popup.remove();
            resetSidePanel();
        }

        // Hide or show a layer
        function toggleLayer(layerID, enabled) {
            map.setLayoutProperty(
                layerID,
                "visibility",
                (enabled ? "visible" : "none")
            );
        }
        
        // Triggered after layer change
        function layerCallback(layerID, enabled) {

            if (enabled && layerID.includes("power_")) {
                // Show the power layers
                toggleLayer("power_locations", true);
                toggleLayer("power_labels", true);

                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);
        
                //PP_fossil
                toggleLayer("PP_fossil", false);
            }
    
            if (enabled && layerID.includes("retrofitting_1")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", true);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_1_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);
                
            }

            if (enabled && layerID.includes("retrofitting_2")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", true);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_2_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);
            }

            if (enabled && layerID.includes("retrofitting_5")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_2_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", true);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_5_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);
            }

            if (enabled && layerID.includes("retrofitting_10")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", true);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_10_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("retrofitting_14")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", true);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_14_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);
                
                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }


            if (enabled && layerID.includes("retrofitting_20")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", true);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", true);
                toggleLayer("retrofitting_20_SMR_29bus_closed", true);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("ranking_1_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // open ranking_1_
                toggleLayer("ranking_1_", true);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("ranking_10_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // open ranking_10_
                toggleLayer("ranking_10_", true);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("ranking_100_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // open ranking_100_
                toggleLayer("ranking_100_", true);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }


            if (enabled && layerID.includes("ranking_1000_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // open ranking_1000_
                toggleLayer("ranking_1000_", true);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

        
            if (enabled && layerID.includes("ranking_10000_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // open ranking_10000_
                toggleLayer("ranking_10000_", true);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("ranking_100000_")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // close ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // open ranking_100000_
                toggleLayer("ranking_100000_", true);

                //PP_fossil
                toggleLayer("PP_fossil", false);

            }

            if (enabled && layerID.includes("PP_fossil")) {
                // Show the power layers
                toggleLayer("power_locations", false);
                toggleLayer("power_labels", false);               
                
                // show retrofitting results --smr1
                toggleLayer("retrofitting_1_SMR_29bus_extant", false);
                toggleLayer("retrofitting_1_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_1_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr2
                toggleLayer("retrofitting_2_SMR_29bus_extant", false);
                toggleLayer("retrofitting_2_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_2_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr5
                toggleLayer("retrofitting_5_SMR_29bus_extant", false);
                toggleLayer("retrofitting_5_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_5_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 
                
                // show retrofitting results --smr10
                toggleLayer("retrofitting_10_SMR_29bus_extant", false);
                toggleLayer("retrofitting_10_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_10_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // show retrofitting results --smr14
                toggleLayer("retrofitting_14_SMR_29bus_extant", false);
                toggleLayer("retrofitting_14_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_14_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true);

                // show retrofitting results --smr20
                toggleLayer("retrofitting_20_SMR_29bus_extant", false);
                toggleLayer("retrofitting_20_SMR_29bus_SMR", false);
                toggleLayer("retrofitting_20_SMR_29bus_closed", false);
                // toggleLayer("retrofitting_labels_extant", true);
                // toggleLayer("retrofitting_labels_smr", true); 

                // close ranking_1_
                toggleLayer("ranking_1_", false);
                // toggleLayer("ranking_1_Text", false);

                // close ranking_10_
                toggleLayer("ranking_10_", false);

                // open ranking_100_
                toggleLayer("ranking_100_", false);

                // close ranking_1000_
                toggleLayer("ranking_1000_", false);

                // close ranking_10000_
                toggleLayer("ranking_10000_", false);

                // close ranking_100000_
                toggleLayer("ranking_100000_", false);

                //PP_fossil
                toggleLayer("PP_fossil", true);

            }

            if (enabled) updateLegend(layerID);
        }

        // Setup map with mapbox-controls.js
        setup(map, cameraCallback, terrainCallback, layerCallback);


        // On initial load...
        map.on("load", function () {
            resetSidePanel();
            updateLegend("power_locations");
        });

        // Triggers whenever the terrain is changed, at this point MapBox
        // effectively generates a new map so we have to add everything again.
        map.on('style.load', function () {

            // Variable for area currently under mouse cursor
            // var hoveredStateId = null;

            console.log("INFO: New style has been loaded.");
            refresh();

// ===== SOURCES ====
            // PP_fossil
            map.addSource('PP_fossil', {
                type: 'geojson',
                data: 'PP_fossil.geojson' 
            });

            // Add the ranking results- weight 1
            map.addSource('ranking_1_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_1.geojson' 
            });

            // Add the ranking results- weight 10
            map.addSource('ranking_10_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_10.geojson' 
            });
            // Add the ranking results- weight 100
            map.addSource('ranking_100_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_100.geojson' 
            });

            // Add the ranking results- weight 1000
            map.addSource('ranking_1000_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_1000.geojson' 
            });

            // Add the ranking results- weight 10000
            map.addSource('ranking_10000_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_10000.geojson' 
            });

            // Add the ranking results- weight 100000
            map.addSource('ranking_100000_', {
                type: 'geojson',
                data: 'ranking_1_SMRUnitPerSite_Weighter_100000.geojson' 
            });



            // Add the retrofitting results of 29 bus model--smr1
            map.addSource('retrofitting_1_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_1_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_1_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_1_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_1_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_1_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            // Add the retrofitting results of 29 bus model--smr2
             map.addSource('retrofitting_2_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_2_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_2_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_2_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_2_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_2_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            // Add the retrofitting results of 29 bus model--smr5
            map.addSource('retrofitting_5_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_5_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_5_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_5_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_5_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_5_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            // Add the retrofitting results of 29 bus model--smr10
            map.addSource('retrofitting_10_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_10_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_10_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_10_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_10_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_10_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            // Add the retrofitting results of 29 bus model--smr14
            map.addSource('retrofitting_14_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_14_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_14_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_14_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_14_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_14_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            // Add the retrofitting results of 29 bus model--smr20
            map.addSource('retrofitting_20_SMR_29bus_extant', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_20_SMRs_retrofitted_ExtantGenerator_CarbonTax60.geojson' 
            });

            map.addSource('retrofitting_20_SMR_29bus_SMR', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_20_SMRs_retrofitted_SMR_CarbonTax60.geojson'
            });

            map.addSource('retrofitting_20_SMR_29bus_closed', {
                type: 'geojson',
                data: 'NewSelector_29BusModel_20_SMRs_retrofitted_ClosedPlants_CarbonTax60.geojson'
            });

            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            // Add the powerplant data
            map.addSource('powerplants', {
                type: 'geojson',
                data: 'UK_PowerPlants.geojson'
            });
            
            // add smr icon
            map.loadImage('/smr.png', (error, image) => {
                if (error) throw error;
                map.addImage('SMR_icon', image);
            });

            // add closed icon
            map.loadImage('/closed.png', (error, image) => {
                if (error) throw error;
                map.addImage('Closed_icon', image);
            });


        // ===== LAYERS =====
            // PP_fossil
            map.addLayer({
                'id': 'PP_fossil',
                'type': 'circle',
                'source': 'PP_fossil',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Capacity"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_1
            map.addLayer({
                'id': 'ranking_1_',
                'type': 'circle',
                'source': 'ranking_1_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_10
            map.addLayer({
                'id': 'ranking_10_',
                'type': 'circle',
                'source': 'ranking_10_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_100
            map.addLayer({
                'id': 'ranking_100_',
                'type': 'circle',
                'source': 'ranking_100_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_1000
            map.addLayer({
                'id': 'ranking_1000_',
                'type': 'circle',
                'source': 'ranking_1000_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_10000
            map.addLayer({
                'id': 'ranking_10000_',
                'type': 'circle',
                'source': 'ranking_10000_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // ranking_100000
            map.addLayer({
                'id': 'ranking_100000_',
                'type': 'circle',
                'source': 'ranking_100000_',
                'layout': {
                    'visibility': 'visible',
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // map.addLayer({
            //     'id': 'ranking_1_Text',
            //     'type': 'symbol',
            //     'source': 'ranking_1_',
            //     'layout': {
            //         'icon-image': 'Closed_icon',
            //         'icon-opacity': 0.9,
            //         'text-justify': 'auto',
            //         'icon-size': 0.05,
            //         'text-field': ['get', 'Rank number'],
            //         'text-anchor': 'middle'
            //     }
            // });
           
            // console.log('ranking_1_Text added')

            // Locations for extant power generator after retrofitting--smr1
            map.addLayer({
                'id': 'retrofitting_1_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_1_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // // add smr layer--smr1
            // map.addLayer({
            //     id: 'retrofitting_1_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_1_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.15
            //     }
            // });

            // add smr layer--smr1
            map.addLayer({
                'id': 'retrofitting_1_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_1_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr1
            map.addLayer({
                id: 'retrofitting_1_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_1_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });


            // Locations for extant power generator after retrofitting--smr2
            map.addLayer({
                'id': 'retrofitting_2_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_2_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add smr layer--smr2
            // map.addLayer({
            //     id: 'retrofitting_2_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_2_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.15
            //     }
            // });

            map.addLayer({
                'id': 'retrofitting_2_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_2_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr2
            map.addLayer({
                id: 'retrofitting_2_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_2_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });

            // Locations for extant power generator after retrofitting--smr5
            map.addLayer({
                'id': 'retrofitting_5_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_5_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add smr layer--smr5
            // map.addLayer({
            //     id: 'retrofitting_5_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_5_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.05
            //     }
            // });

            map.addLayer({
                'id': 'retrofitting_5_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_5_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr5
            map.addLayer({
                id: 'retrofitting_5_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_5_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });
            
            // Locations for extant power generator after retrofitting--smr10
            map.addLayer({
                'id': 'retrofitting_10_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_10_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add smr layer--smr10
            // map.addLayer({
            //     id: 'retrofitting_10_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_10_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.15
            //     }
            // });

            map.addLayer({
                'id': 'retrofitting_10_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_10_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr10
            map.addLayer({
                id: 'retrofitting_10_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_10_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });

            // Locations for extant power generator after retrofitting--smr14
            map.addLayer({
                'id': 'retrofitting_14_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_14_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add smr layer--smr14
            // map.addLayer({
            //     id: 'retrofitting_14_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_14_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.15
            //     }
            // });

            map.addLayer({
                'id': 'retrofitting_14_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_14_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr14
            map.addLayer({
                id: 'retrofitting_14_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_14_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });

            // Locations for extant power generator after retrofitting--smr20
            map.addLayer({
                'id': 'retrofitting_20_SMR_29bus_extant',
                'type': 'circle',
                'source': 'retrofitting_20_SMR_29bus_extant',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 2, ["*", 0.9, ["ln", ["to-number", ["get", "Output"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-opacity': 0.85,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add smr layer--smr20
            // map.addLayer({
            //     id: 'retrofitting_10_SMR_29bus_SMR',
            //     type: 'symbol',
            //     source: 'retrofitting_10_SMR_29bus_SMR',
            //     layout: {
            //         'icon-image': 'SMR_icon',
            //         'icon-size': 0.15
            //     }
            // });

            map.addLayer({
                'id': 'retrofitting_20_SMR_29bus_SMR',
                'type': 'circle',
                'source': 'retrofitting_20_SMR_29bus_SMR',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': 8,
                    'circle-color': "#50C878",
                    'circle-opacity': 0.95,
                    'circle-stroke-width': 0,
                    'circle-stroke-color': inner_text
                }
            });

            // add closed layer--smr20
            map.addLayer({
                id: 'retrofitting_20_SMR_29bus_closed',
                type: 'symbol',
                source: 'retrofitting_20_SMR_29bus_closed',
                layout: {
                    'icon-image': 'Closed_icon',
                    'icon-size': 0.03
                }
            });


            // Locations for power generation
            map.addLayer({
                'id': 'power_locations',
                'type': 'circle',
                'source': 'powerplants',
                'layout': {
                    'visibility': 'visible'
                },
                'paint': {
                    'circle-radius': ["+", 3, ["*", 0.9, ["ln", ["to-number", ["get", "capacity"]]]]],
                    'circle-color': ["get", "marker-color"],
                    'circle-stroke-width': 1,
                    'circle-stroke-color': inner_text
                }
            });
        });

        // ===== LAYERS END =====

        // ===== MOUSE EVENTS =====

        // click action of the ranking_1_ layer

        map.on('click', 'ranking_1_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the ranking_10_ layer

        map.on('click', 'ranking_10_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the ranking_100_ layer

        map.on('click', 'ranking_100_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the ranking_1000_ layer

        map.on('click', 'ranking_1000_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the ranking_10000_ layer

        map.on('click', 'ranking_10000_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the ranking_100000_ layer

        map.on('click', 'ranking_100000_', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var capacity = e.features[0].properties["Capacity"];
            var obj1 = e.features[0].properties["SMR cost and risk cost"];
            var obj2 = e.features[0].properties["Weighed demanding distance"];
            var weighter = e.features[0].properties["weighter"];
            var rank = e.features[0].properties["Rank number"];

            siteRankingResult(fuel, capacity, obj1, obj2, weighter, coordinates, rank);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr1
        map.on('click', 'retrofitting_1_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];


            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr1
        map.on('click', 'retrofitting_1_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];


            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_1_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_1_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

    
        // click action of the retrofitting results--smr2
         map.on('click', 'retrofitting_2_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];


            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_2_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_2_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr5
        map.on('click', 'retrofitting_5_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];


            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_5_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_5_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr10
        map.on('click', 'retrofitting_10_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_10_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_10_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr14
        map.on('click', 'retrofitting_14_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_14_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_14_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // click action of the retrofitting results--smr20
        map.on('click', 'retrofitting_20_SMR_29bus_extant', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var status = e.features[0].properties["Status"];


            selectRetrofit_extant(fuel, capacity, output, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_20_SMR_29bus_SMR', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        map.on('click', 'retrofitting_20_SMR_29bus_closed', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var fuel = e.features[0].properties["Fuel Type"];
            var output = e.features[0].properties["Output"];
            var capacity = e.features[0].properties["Capacity"];
            var numberOfUnit = e.features[0].properties["Number of SMR units"];
            var status = e.features[0].properties["Status"];

            selectRetrofit_smr(fuel, capacity, output, numberOfUnit, coordinates, status);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // On mouse enter
        map.on('mouseenter', 'power_locations', function (e) {
            map.getCanvas().style.cursor = 'pointer';

            if (map.getZoom() < 7.5) {
                var coordinates = e.features[0].geometry.coordinates.slice();
                var name = e.features[0].properties["name"];
                name = name.replaceAll("_", " ");

                var fuel = e.features[0].properties["fuel"];

                var html = `
                                <b> ` + name + `</b><br>
                                Fuel: ` + fuel + `
                                <br><p>Click for more details.</p>
                            `;
                popup.setLngLat(coordinates).setHTML(html).addTo(map);
            }
        });

        // On mouse exit
        map.on('mouseleave', 'power_locations', function (e) {
            map.getCanvas().style.cursor = '';
            popup.remove();
        });

        // On selection
        map.on('click', 'power_locations', function (e) {
            var coordinates = e.features[0].geometry.coordinates.slice();
            var name = e.features[0].properties["name"];
            name = name.replaceAll("_", " ");

            var fuel = e.features[0].properties["fuel"];
            var capacity = e.features[0].properties["capacity"];
            var indicator = e.features[0].properties["sdg941"];

            selectPlant(name, fuel, capacity, indicator, coordinates);

            map.flyTo({
                center: coordinates,
                curve: 1.9,
                speed: 1.6,
                pitch: 75,
                zoom: 14,
                bearing: Math.random() * 90
            });
        });

        // ===== MOUSE EVENTS =====
        // Register the layers with the central controls
        registerLayer("Power Generation", ["power_locations", "power_labels"], null, true);
      
        registerLayer("SMR 1", ["retrofitting_1_SMR_29bus_extant", "retrofitting_1_SMR_29bus_SMR", "retrofitting_1_SMR_29bus_closed"], null, false);

        registerLayer("SMR 2", ["retrofitting_2_SMR_29bus_extant", "retrofitting_2_SMR_29bus_SMR", "retrofitting_2_SMR_29bus_closed"], null, false);
        
        registerLayer("SMR 5", ["retrofitting_5_SMR_29bus_extant", "retrofitting_5_SMR_29bus_SMR", "retrofitting_5_SMR_29bus_closed"], null, false);
        
        registerLayer("SMR 10", ["retrofitting_10_SMR_29bus_extant", "retrofitting_10_SMR_29bus_SMR", "retrofitting_10_SMR_29bus_closed"], null, false);
        
        registerLayer("SMR 14", ["retrofitting_14_SMR_29bus_extant", "retrofitting_14_SMR_29bus_SMR", "retrofitting_14_SMR_29bus_closed"], null, false);
        
        registerLayer("SMR 20", ["retrofitting_20_SMR_29bus_extant", "retrofitting_20_SMR_29bus_SMR", "retrofitting_20_SMR_29bus_closed"], null, false);
        
        registerLayer("Ranking 1", ["ranking_1_"], null, false);

        registerLayer("Ranking 10", ["ranking_10_"], null, false);

        registerLayer("Ranking 100", ["ranking_100_"], null, false);

        registerLayer("Ranking 1000", ["ranking_1000_"], null, false);

        registerLayer("Ranking 10000", ["ranking_10000_"], null, false);

        registerLayer("Ranking 100000", ["ranking_100000_"], null, false);

        registerLayer("UK fossil power plant", ["PP_fossil"], null, false); 
        

        // registerLayer("SMR Retrofitting Results", ["retrofitting_29bus_extant", "retrofitting_29bus_SMR", "retrofitting_labels_extant", "retrofitting_labels_smr"], null, false);
        
        // registerLayer("Non-Retrofitting Results", ["non_retrofitting_29bus", "non_retrofitting_labels_29bus"], null, false);
        

        // Build the layer selection tree
        buildLayerTree("radio");
    </script>

</body>

</html>
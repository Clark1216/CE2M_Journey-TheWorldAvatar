let listGeoJsonAddedToOSMB = [] // edit
const profiles = [
  "1020","1020",
  "1120","1120",
  "1220","1220",
  "1320","1320",
  "1420","1420",
  "1520","1520",
  "1620","1620",
  "1720","1720",
  "1820","1820",
  "1920","1920",
  "2020","2020",
  "2120","2120",
  "2220","2220",
  "2320","2320",
  "2420","2420",
  "0300","0300",
  "0400","0400",
  "0500","0500",
  "0600","0600",
  "0700","0700",
  "0800","0800",
  "0900","0900",
  "1000","1000"
  ]
let preobjs = []
let ships = []
//let buildings_hk = [{"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 130.79999999999998, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15310794100301, 22.28418155614396], [114.15320716055211, 22.28428017320016], [114.15313376209916, 22.28436935174224], [114.15305784469551, 22.2843948680756], [114.153022110832, 22.284303490175787], [114.15305382912676, 22.284292407193448], [114.15305246489527, 22.28428902538294], [114.153062885486, 22.284279524425372], [114.15306792632998, 22.284284409110004], [114.15308109625919, 22.284272400385667], [114.15306160493945, 22.28425351285482], [114.15306175239903, 22.284244529654433], [114.15307630907714, 22.28423125738668], [114.15307093215922, 22.284226047008485], [114.15307028311885, 22.284214961540805], [114.15310794100301, 22.28418155614396]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 121.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15515071734079, 22.283328016584672], [114.15513259804534, 22.283343698930583], [114.15513920625807, 22.28335031186303], [114.15496990757156, 22.28349868829904], [114.15496325510594, 22.28349211391467], [114.15494135610129, 22.283511306478967], [114.1549248380655, 22.283494982464596], [114.15491549922055, 22.28350316711264], [114.1548026833535, 22.283391675807213], [114.15488760062743, 22.283315324355428], [114.15486921347373, 22.28329692393968], [114.15500113227735, 22.283178324441113], [114.15515071734079, 22.283328016584672]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 121.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14704691522041, 22.28701717399469], [114.14702405042844, 22.287004760088017], [114.1470200653148, 22.28701110120609], [114.14699166606785, 22.286995643588536], [114.14701189526306, 22.286963038695937], [114.1470044391001, 22.28695898410884], [114.14701288263458, 22.286945569124615], [114.14694914986408, 22.286911142399894], [114.14694082959765, 22.286924393858847], [114.14693337343881, 22.286920339268473], [114.14691296794375, 22.286952808388612], [114.14686770531094, 22.28692817197936], [114.14688496946155, 22.286901007419022], [114.14688070636407, 22.28689854659883], [114.14689801536908, 22.286870788281387], [114.14690425417682, 22.2868607831328], [114.14689422169026, 22.286855335813506], [114.1469196487992, 22.28681443463809], [114.14694076701426, 22.28682576907792], [114.14694390306991, 22.286820708529234], [114.14696888659886, 22.286834190799425], [114.14697196450277, 22.28682925106932], [114.14700246868094, 22.28684590969958], [114.14701360385284, 22.28682825027191], [114.14698290917319, 22.286811685978762], [114.14698598707609, 22.286806746248377], [114.1469608996199, 22.286793281481078], [114.14696403567412, 22.28678822093198], [114.14694298965782, 22.286776889307905], [114.14696836402919, 22.286736072912333], [114.14697853750066, 22.286741540933196], [114.14699832028522, 22.28671079581733], [114.1470028530238, 22.286703751223804], [114.14700703503081, 22.286706040985827], [114.14702548096918, 22.286677373388226], [114.14706934227097, 22.28670138809967], [114.14704824855879, 22.28673475511737], [114.14705609465217, 22.2867390509822], [114.14704871396222, 22.28675072623259], [114.1471128389584, 22.28678583561593], [114.14712006838151, 22.286774077524118], [114.14712791409121, 22.286778373114466], [114.14714857534659, 22.286744769314687], [114.1471930866672, 22.286769139827886], [114.14717537118842, 22.28679716315195], [114.14717973308595, 22.28679955706551], [114.14715650732444, 22.2868373317384], [114.14716620988393, 22.286842824134364], [114.14714096541968, 22.28688348318025], [114.14711988318412, 22.286872132066435], [114.147116866435, 22.28687699089607], [114.14709181659985, 22.28686354629428], [114.14708860250607, 22.28686872305571], [114.14707141199985, 22.28685944635198], [114.14706023115146, 22.286877454357487], [114.1470773701148, 22.286886814044422], [114.14707461710395, 22.28689124803048], [114.14709963277362, 22.286904747625154], [114.14709670503657, 22.286909463064298], [114.14711780406901, 22.28692078718256], [114.14709258209706, 22.286961409921496], [114.14708434349703, 22.286957007063982], [114.14704691522041, 22.28701717399469]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 120.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15698700273617, 22.28343482658589], [114.15688669345202, 22.28356280610122], [114.15676332653973, 22.283477825551536], [114.1567845495464, 22.283451099212698], [114.15679234892742, 22.283456471777015], [114.15685076126066, 22.28338291263191], [114.15684294120936, 22.283377565985727], [114.15686416428281, 22.28335083954584], [114.15689392274247, 22.28337118596964], [114.15698700273617, 22.28343482658589]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 118.8, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15252402608483, 22.284832907458014], [114.15245070551703, 22.284786032270315], [114.15246965308509, 22.284759287465505], [114.15247908774997, 22.284766151709754], [114.15251251038046, 22.2847233750021], [114.15252767739022, 22.28473272036516], [114.15252006521519, 22.284742336848886], [114.15254693847143, 22.284759847383082], [114.15255269762129, 22.284751527058617], [114.1525725424691, 22.284764074837213], [114.15252402608483, 22.284832907458014]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 114.4, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.1510379372108, 22.28533931269468], [114.15087295112643, 22.28544433811016], [114.15085019179702, 22.28541423013768], [114.15082956180092, 22.285427362520622], [114.15077961561727, 22.285361343217513], [114.15080027326691, 22.285348193235524], [114.15078198827578, 22.285324004194784], [114.15094750495466, 22.285216991222402], [114.15097258205512, 22.285250912283757], [114.1510379372108, 22.28533931269468]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 107.50000000000001, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14671004917058, 22.283217173837784], [114.14675279871516, 22.2831702504628], [114.14686927112429, 22.28304240635126], [114.14687564717529, 22.283047385122714], [114.14693262727742, 22.28298418200093], [114.14693564574974, 22.282980895405988], [114.14699434441401, 22.283025451249067], [114.14695699448622, 22.283066880270585], [114.14698322623775, 22.283087429605917], [114.14695608004263, 22.283117535003953], [114.1469984481371, 22.283150624082047], [114.14698472537385, 22.2831658427835], [114.1470058560205, 22.283182345633936], [114.14698307675037, 22.28320701313913], [114.14696158807509, 22.28319036762621], [114.14694711011805, 22.28320679177505], [114.1469684346107, 22.283223440691298], [114.14694594254313, 22.283248140844556], [114.1469273440555, 22.283233724529172], [114.14691360659623, 22.283249074617434], [114.14686947655366, 22.283214993357987], [114.14681303054232, 22.283219380850937], [114.14680915796205, 22.283223579379563], [114.14677761787337, 22.283258231761767], [114.14671004917058, 22.283217173837784]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 106.89999999999999, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15354839851342, 22.285958753617773], [114.15332794844086, 22.286086722829143], [114.15330827387969, 22.286083753778843], [114.15329129920639, 22.28602550239537], [114.153299955495, 22.286016569195564], [114.15327166614384, 22.285917955028644], [114.15334208807809, 22.285899451896796], [114.15333520308451, 22.28587307901982], [114.1533475051269, 22.285860036053148], [114.15351508400748, 22.285846415644205], [114.15354839851342, 22.285958753617773]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 102.9, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14919322857655, 22.28710318425409], [114.14936093824554, 22.28697162976364], [114.14936457594624, 22.28696881679617], [114.14938788490767, 22.287071103724934], [114.14941643177079, 22.287196375749627], [114.14941689860662, 22.287198424246107], [114.14941324547509, 22.287199728826053], [114.14930164170154, 22.28723913802834], [114.14929275116332, 22.28721716445763], [114.14927348246258, 22.28722396856669], [114.14926440980321, 22.287227172177342], [114.1492460286658, 22.287233662890372], [114.1492431120666, 22.287226455320464], [114.14923455246884, 22.287205303138524], [114.14919322857655, 22.28710318425409]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 97.8, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15073892262079, 22.286007233064545], [114.15062159745234, 22.28605953294508], [114.15051879015134, 22.28591267202927], [114.15059051641731, 22.285869229145227], [114.1505997392093, 22.28588246809552], [114.15061364606143, 22.285902431016062], [114.15061422232779, 22.285902091015558], [114.15064682184082, 22.285882860490847], [114.15073892262079, 22.286007233064545]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 97.2, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14565171863023, 22.286230462578633], [114.14565162774508, 22.286230289805218], [114.14564745168472, 22.286222351891997], [114.14559689905632, 22.28624537506734], [114.14557607709108, 22.286205687220175], [114.14562768315197, 22.286182169826642], [114.14563140078116, 22.28617142598759], [114.14567354808551, 22.28615221897761], [114.14568504376248, 22.286156029942], [114.14573563206058, 22.28613297631251], [114.14575637875386, 22.28617269040433], [114.14570584856722, 22.286195756062043], [114.1457299668064, 22.2862416001629], [114.14570431749078, 22.28625331917258], [114.14567160618589, 22.286268264912014], [114.14565171863023, 22.286230462578633]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 97.1, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15331382984965, 22.286592365291764], [114.1533700946818, 22.2867897915851], [114.15319090786085, 22.286833959960457], [114.15303293890253, 22.286872897999235], [114.15289297383406, 22.28690739808865], [114.15274583064496, 22.286943667447407], [114.15269375055205, 22.28691428226135], [114.15259642353664, 22.28657491519965], [114.15266603156188, 22.286557496639475], [114.15265357391483, 22.286515954788776], [114.15273882754045, 22.286494118303807], [114.15286824108263, 22.28646097084095], [114.15299356234, 22.286428871401064], [114.15313034263517, 22.286393836776448], [114.15314575985185, 22.286444549357295], [114.15326312784215, 22.286414458225202], [114.15331382984965, 22.286592365291764]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 94.6, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15233169698033, 22.285838074626806], [114.1523690876635, 22.285969727357298], [114.15219921575417, 22.28601321116318], [114.1521580368707, 22.28587626668177], [114.15224211969885, 22.285854057403004], [114.15224401119204, 22.2858609426425], [114.15233169698033, 22.285838074626806]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 90.4, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15316545848545, 22.282966167691388], [114.1532445632918, 22.283016277908732], [114.15324808413692, 22.283017754296672], [114.15325638269648, 22.283023138843358], [114.15326618983026, 22.283030396110536], [114.1532790141109, 22.283042569008327], [114.15329334712285, 22.283056848609494], [114.15332040585982, 22.283083173757642], [114.15329548086063, 22.283112827652175], [114.15328635138408, 22.283123689188038], [114.15326863510123, 22.283110322724685], [114.15322421416663, 22.283163171489974], [114.15319126628803, 22.283134051661534], [114.15314341800074, 22.283088115154506], [114.15310303576592, 22.28304915408305], [114.15316545848545, 22.282966167691388]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 89.2, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15732962911429, 22.283507982455962], [114.15722442126152, 22.28363956508434], [114.15703345339136, 22.283507346710437], [114.15705425499934, 22.283480808212527], [114.15698700273617, 22.28343482658589], [114.15689392274247, 22.28337118596964], [114.15686416428281, 22.28335083954584], [114.15697179402459, 22.283215300038066], [114.15711386966095, 22.283313119660793], [114.15715976879376, 22.283344721248707], [114.15713710357585, 22.283374029500944], [114.15719229616748, 22.283412430738473], [114.15732962911429, 22.283507982455962]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 86.30000000000001, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14666520774392, 22.286080320790486], [114.14666546373643, 22.286077561167712], [114.1466663162727, 22.2860749767597], [114.14666776485343, 22.286072633309328], [114.14666973696703, 22.28607064820131], [114.14667213390587, 22.28606912084454], [114.1466769147011, 22.28606779386866], [114.14671185197084, 22.286065529963093], [114.14671747202345, 22.286065165716618], [114.14672287832269, 22.28606562195338], [114.14672549349719, 22.28606680987593], [114.14672771225288, 22.286068563584244], [114.14672939885945, 22.28607077161518], [114.14673044941962, 22.286073298128816], [114.146730833304, 22.28607598354825], [114.1467308388173, 22.28607606663107], [114.14673108102139, 22.286079690306735], [114.14674559945836, 22.28607875498621], [114.14674620158317, 22.286087768118453], [114.14679431709943, 22.286084668232892], [114.14679715122018, 22.286122966035126], [114.14672981921572, 22.286127916619087], [114.14673303168388, 22.28616114379346], [114.14667741091402, 22.286165233378682], [114.14667435789273, 22.286131994402734], [114.14660623239801, 22.286137003306525], [114.14660312932493, 22.286096985567447], [114.14665163164099, 22.28609386078136], [114.14665095664672, 22.28608485215054], [114.14666547712255, 22.286083916747266], [114.14666520774392, 22.286080320790486]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 85.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14823592297356, 22.28772228048048], [114.1481591393767, 22.287785172851823], [114.14807848548242, 22.28769702091597], [114.1480894214197, 22.28768812921841], [114.14803288950074, 22.287626274022823], [114.14806348062784, 22.287601218548577], [114.14807595213631, 22.287614842468223], [114.14809509865626, 22.287636172049485], [114.14810772275813, 22.28762583069166], [114.14813720179149, 22.28765797248079], [114.14815991135087, 22.287639370056503], [114.14823592297356, 22.28772228048048]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 84.9, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14840289242052, 22.28748755264841], [114.14835303458462, 22.287527784482915], [114.14833798876396, 22.287539925510195], [114.1483073148365, 22.287507065341202], [114.14826529833539, 22.287462054175432], [114.14823109736726, 22.287489545606302], [114.14817561681221, 22.28753414189193], [114.14810733373734, 22.287460038571826], [114.14809043207882, 22.287441696630754], [114.14809035301072, 22.287441610825788], [114.14824714159282, 22.28731043376182], [114.14832577243924, 22.28739614301942], [114.14833870991765, 22.287384924282403], [114.14839239993876, 22.287440998911755], [114.14837814945743, 22.28745214933193], [114.1483737652832, 22.287455580112198], [114.14840278492669, 22.287487434599257], [114.14840289242052, 22.28748755264841]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 84.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15313923743938, 22.283974704402294], [114.15316036960633, 22.28399641658446], [114.15317511679554, 22.28398332892132], [114.15317525072062, 22.28398323095846], [114.15318590286206, 22.28399417556028], [114.15320251273604, 22.28398051417886], [114.15321820149308, 22.283981053422604], [114.15324882832991, 22.28401114424051], [114.15324818242193, 22.284025857666837], [114.15323567495638, 22.284036908712455], [114.1532469361115, 22.28404836263609], [114.15322945483639, 22.284063882038343], [114.1532550181903, 22.284089388169395], [114.15325000120643, 22.28409382852554], [114.15326240511025, 22.284106110723034], [114.1532341828863, 22.284130928582933], [114.15318456066386, 22.284081935779046], [114.15317634609119, 22.284089159540446], [114.1531448137119, 22.284057963227564], [114.15317161522775, 22.284034394744676], [114.15315998011567, 22.28402288368766], [114.15314134639452, 22.28403926967262], [114.15310407097941, 22.284002466928776], [114.15313923743938, 22.283974704402294]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 83.19999999999999, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15336192262598, 22.28461340927934], [114.1533791503019, 22.28459848250769], [114.15336658744614, 22.284585924320723], [114.15338008142427, 22.28457423259461], [114.15337743657703, 22.284571588765854], [114.15342528747351, 22.2845301289029], [114.15342793232087, 22.284532772730888], [114.15344142628877, 22.284521081089906], [114.15345398924244, 22.284533639271203], [114.15346961383428, 22.284520101531488], [114.15351785959899, 22.28456832906329], [114.1534844662941, 22.28459726229465], [114.15348429185902, 22.284598220509977], [114.15348411025509, 22.2845991076532], [114.15348390837136, 22.284599990910323], [114.15348368620788, 22.284600870010447], [114.15348344395876, 22.284601744411745], [114.15348318152706, 22.284602613843298], [114.15348289920398, 22.28460347776331], [114.15348259708657, 22.284604335991165], [114.15348227527194, 22.28460518789475], [114.15348193395427, 22.284606033203158], [114.15348157332764, 22.284606871555223], [114.15348119339217, 22.284607702499375], [114.15348079443895, 22.284608525764757], [114.15348037675922, 22.28460934080957], [114.15347994035301, 22.284610147362887], [114.15347948541445, 22.284610945063537], [114.15347901233177, 22.28461173346002], [114.15347852120206, 22.284612512281424], [114.15347801221944, 22.28461328116656], [114.15347748577207, 22.284614039754267], [114.15347694195712, 22.284614787593032], [114.1534763810657, 22.28461552450227], [114.15347580329197, 22.284616250030474], [114.15347520902411, 22.284616963906796], [114.15347459845623, 22.284617665770018], [114.15347397187954, 22.284618355258974], [114.15347332958513, 22.284619032193085], [114.15347267186421, 22.28461969612086], [114.1534719990079, 22.284620346861736], [114.15347131140446, 22.284620983964242], [114.15347060924795, 22.284621607247768], [114.15346989292657, 22.28462221644148], [114.15346916273147, 22.284622811184164], [114.15346841905088, 22.284623391204992], [114.15346766217587, 22.28462395632337], [114.15346689249472, 22.28462450626844], [114.15346611039551, 22.284625040679018], [114.15346531607246, 22.284625559464857], [114.15346451010777, 22.284626062264778], [114.15346369269552, 22.28462654889823], [114.15346286432099, 22.284627019094344], [114.15346202527527, 22.284627472762864], [114.1534611759466, 22.28462790954262], [114.1534603168201, 22.284628329343366], [114.15345944828404, 22.284628731894237], [114.15345857062948, 22.284629117105], [114.15345768434167, 22.284629484704762], [114.15345678980877, 22.284629834603297], [114.15345588741897, 22.284630166529734], [114.15345497756041, 22.28463048039384], [114.15345406071829, 22.284630776195655], [114.15345313728082, 22.284631053574024], [114.15345220763614, 22.284631312438716], [114.15345127236644, 22.284631552789783], [114.15345033166587, 22.284631774446662], [114.15344938611662, 22.284631977319112], [114.1534484362039, 22.28463216131691], [114.15344748212183, 22.284632326259466], [114.1534465245496, 22.284632472237195], [114.15344556387544, 22.28463259906952], [114.15344460048746, 22.284632706756508], [114.1534436966202, 22.284632586699527], [114.15343049825503, 22.284644022274406], [114.1534101683857, 22.2846616368426], [114.15336192262598, 22.28461340927934]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 82.9, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14931924631111, 22.284468798957516], [114.14928247305195, 22.284498953589356], [114.14923036525776, 22.28444349981795], [114.14920496511891, 22.284464352375693], [114.1491265569623, 22.28438180219642], [114.1491542316931, 22.284359045207175], [114.14909988725182, 22.284305487083362], [114.14910163116672, 22.2843040410351], [114.1490979551624, 22.284300160034775], [114.1491306719808, 22.28427325018071], [114.14918664534802, 22.284331782373236], [114.14920002784679, 22.284320672819156], [114.14914784412709, 22.28426594218027], [114.14918393502724, 22.28423614895807], [114.14923573939213, 22.284292599224422], [114.14926458923122, 22.284269119152448], [114.14929645933977, 22.284302860113627], [114.14925047482932, 22.284340462364636], [114.14926426914191, 22.284355095325246], [114.14931025469554, 22.284317622479527], [114.14934220145874, 22.284351492763196], [114.14931346530673, 22.28437514923625], [114.149366634588, 22.284430065206248], [114.1493309228924, 22.284458861911983], [114.14930587322077, 22.28443231257499], [114.14929393138107, 22.284442064355503], [114.14931924631111, 22.284468798957516]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 82.19999999999999, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.15079746985577, 22.28638564367188], [114.15078790867412, 22.286387963461973], [114.15067738058073, 22.28641085297187], [114.15064853922016, 22.286299630421432], [114.15068680315, 22.2862918810823], [114.1506842520595, 22.28628192711065], [114.15074155317177, 22.286270380372862], [114.15074335461657, 22.286280551319546], [114.1507692201737, 22.28627631017431], [114.15079746985577, 22.28638564367188]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 82.10000000000001, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14789223281026, 22.285761632566427], [114.14787928669867, 22.285771976019923], [114.14787827376668, 22.28577088051409], [114.14784572810858, 22.285735680442176], [114.14781173219328, 22.285698911935324], [114.14780436596133, 22.2856909445184], [114.14779692493168, 22.285682897166673], [114.14778948487323, 22.28567484981477], [114.14778204374825, 22.28566680246234], [114.1477604363471, 22.28564343228884], [114.14784899934, 22.28557307476299], [114.14785982686922, 22.28556448242449], [114.1479035702657, 22.28561206277572], [114.14792598116098, 22.285594766877683], [114.147933444885, 22.285602886653276], [114.14796354339352, 22.28563563102514], [114.14796695734037, 22.28563934538879], [114.14797173356779, 22.28564454183076], [114.14799799593733, 22.285673112278978], [114.14800012424668, 22.285675427749478], [114.14797499886349, 22.285695502803335], [114.14789223281026, 22.285761632566427]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 81.9, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.14591326092683, 22.286157282223055], [114.14585393725946, 22.286161165103152], [114.14585443535255, 22.286167755842445], [114.14582072722067, 22.286169962092462], [114.1458161698982, 22.286109658736724], [114.14583563787177, 22.28610838453013], [114.14583424499472, 22.28608995347017], [114.14583928534768, 22.286084772747035], [114.14588577841718, 22.28608172962373], [114.14589227650339, 22.28608690252356], [114.14589378559083, 22.28610687088938], [114.14590697985784, 22.28610600727534], [114.14590839799776, 22.286124772111563], [114.14591079221844, 22.286124615434602], [114.14591326092683, 22.286157282223055]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 80.2, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[114.1507714173422, 22.286137225903502], [114.15084941972856, 22.286118759206204], [114.1508704472896, 22.286196538694952], [114.15086537973421, 22.286203400260693], [114.15080334426482, 22.286218461546625], [114.15079285287086, 22.286210983315062], [114.150776744269, 22.286155555506856], [114.1507714173422, 22.286137225903502]]]]}}]}]
let buildings = [{"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 245.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853552, 1.279574], [103.853717, 1.279836], [103.854107, 1.279591], [103.853942, 1.279329], [103.853885, 1.279365], [103.853552, 1.279574]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 245.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.854152, 1.2788990000000002], [103.854199, 1.279251], [103.854221, 1.278889], [103.854152, 1.2788990000000002], [103.854562, 1.279202], [103.854767, 1.279175], [103.854745, 1.279016], [103.85472300000002, 1.278852], [103.854697, 1.278656], [103.854351, 1.278703], [103.854358, 1.278755], [103.854205, 1.278775]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 227.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.85493, 1.2796450000000001], [103.85513, 1.279744], [103.855267, 1.279874], [103.855437, 1.279762], [103.855293, 1.2795800000000002], [103.855046, 1.279444], [103.85493, 1.2796450000000001]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 207.0, "minHeight": 193.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.859824, 1.282505], [103.85997, 1.282688], [103.860983, 1.284899], [103.861017, 1.285036], [103.861044, 1.285091], [103.861081, 1.2851350000000001], [103.86111, 1.2851540000000001], [103.861136, 1.285157], [103.861163, 1.28515], [103.861194, 1.285126], [103.861216, 1.285093], [103.861232, 1.285044], [103.860181, 1.2829850000000003], [103.861242, 1.284966], [103.861257, 1.284854], [103.86123, 1.284666], [103.861197, 1.284455], [103.861146, 1.284261], [103.861087, 1.284054], [103.861, 1.2838000000000003], [103.860875, 1.283514], [103.860737, 1.283231], [103.86057400000001, 1.282951], [103.860331, 1.283216], [103.860405, 1.282685], [103.860092, 1.282289], [103.859959, 1.282328], [103.859875, 1.282404], [103.859824, 1.282505], [103.860497, 1.283526], [103.860623, 1.283806], [103.860684, 1.28396], [103.86074600000002, 1.2841250000000002], [103.860846, 1.284442], [103.860915, 1.284702]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 193.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.860397, 1.283426], [103.86063, 1.283922], [103.86101400000001, 1.283741], [103.860781, 1.283246], [103.860397, 1.283426]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 193.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.859841, 1.282589], [103.860141, 1.283021], [103.860526, 1.282754], [103.860226, 1.282321], [103.859841, 1.282589]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 193.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.860765, 1.284288], [103.860906, 1.284803], [103.860965, 1.284787], [103.86122, 1.2847140000000001], [103.861306, 1.284693], [103.861165, 1.284179], [103.860765, 1.284288]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 180.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853914, 1.280014], [103.854069, 1.280443], [103.854137, 1.280422], [103.85415, 1.280459], [103.85451200000001, 1.280328], [103.854379, 1.2799590000000003], [103.854231, 1.279905], [103.853914, 1.280014]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 141.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853461, 1.2770820000000003], [103.853493, 1.277193], [103.85365, 1.277573], [103.853672, 1.277561], [103.853633, 1.2775], [103.853537, 1.277552], [103.853479, 1.277609], [103.85351700000001, 1.277677], [103.853534, 1.277667], [103.853552, 1.277697], [103.853532, 1.277708], [103.853564, 1.277762], [103.853528, 1.277264], [103.85359900000002, 1.277741], [103.853624, 1.277781], [103.853761, 1.277701], [103.853723, 1.277638], [103.853687, 1.277659], [103.853678, 1.277645], [103.853693, 1.277636], [103.853673, 1.2776020000000001], [103.85373200000001, 1.277567], [103.85375, 1.277599], [103.853593, 1.277357], [103.853768, 1.277589], [103.853779, 1.277607], [103.853742, 1.277629], [103.85377700000001, 1.277689], [103.85386, 1.277641], [103.853827, 1.277584], [103.853842, 1.277575], [103.853877, 1.277634], [103.853992, 1.277566], [103.853875, 1.2773650000000003], [103.853653, 1.27745], [103.853828, 1.277392], [103.853817, 1.277373], [103.853863, 1.2773460000000003], [103.853763, 1.277174], [103.853701, 1.27721], [103.853723, 1.277248], [103.853706, 1.277258], [103.853697, 1.277243], [103.853667, 1.277261], [103.85363, 1.277197], [103.853717, 1.27741], [103.85366, 1.277179], [103.853649, 1.277161], [103.853667, 1.27715], [103.85369, 1.277189], [103.853747, 1.277155], [103.853649, 1.276987], [103.85359900000002, 1.277016], [103.853592, 1.277004], [103.853551, 1.277028], [103.853559, 1.277042], [103.853706, 1.277388], [103.853567, 1.277038], [103.853578, 1.277057], [103.853558, 1.277068], [103.853566, 1.277081], [103.853549, 1.277091], [103.853543, 1.277081], [103.853531, 1.277088], [103.85351700000001, 1.277065], [103.853525, 1.27706], [103.853518, 1.277049], [103.853734, 1.277372], [103.853461, 1.2770820000000003], [103.853813, 1.277499], [103.853661, 1.277591]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.856611, 1.28207], [103.856774, 1.282329], [103.856827, 1.282296], [103.856947, 1.28222], [103.856925, 1.282185], [103.85684800000001, 1.282233], [103.856708, 1.282009], [103.856611, 1.28207]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.854351, 1.278703], [103.854358, 1.278755], [103.854373, 1.278869], [103.854515, 1.27885], [103.854541, 1.279043], [103.854745, 1.279016], [103.85472300000002, 1.278852], [103.854697, 1.278656], [103.854351, 1.278703]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.860959, 1.281796], [103.860971, 1.281827], [103.861028, 1.281969], [103.861085, 1.281946], [103.861111, 1.281935], [103.861042, 1.281763], [103.860959, 1.281796]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853287, 1.282622], [103.853302, 1.282911], [103.85330400000001, 1.283675], [103.853311, 1.2838150000000002], [103.853405, 1.283811], [103.85338800000001, 1.283461], [103.853387, 1.283445], [103.853598, 1.283435], [103.853595, 1.283382], [103.853927, 1.283366], [103.853909, 1.282991], [103.853791, 1.282997], [103.853351, 1.282909], [103.85379, 1.282982], [103.85342500000002, 1.283], [103.853406, 1.282616], [103.853287, 1.282622], [103.853356, 1.283004], [103.853372, 1.283325], [103.853291, 1.283329], [103.853295, 1.28342], [103.853329, 1.283418], [103.853331, 1.283464], [103.85334100000001, 1.283673]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853395, 1.279303], [103.853552, 1.279574], [103.855267, 1.279874], [103.85513, 1.279744], [103.85493, 1.2796450000000001], [103.855046, 1.279444], [103.855293, 1.2795800000000002], [103.854807, 1.278845], [103.85472300000002, 1.278852], [103.854745, 1.279016], [103.854767, 1.279175], [103.854562, 1.279202], [103.853942, 1.279329], [103.854199, 1.279251], [103.854152, 1.2788990000000002], [103.854221, 1.278889], [103.854205, 1.278775], [103.853395, 1.279303], [103.854107, 1.279591], [103.853717, 1.279836], [103.854069, 1.280443], [103.853914, 1.280014], [103.854231, 1.279905], [103.854379, 1.2799590000000003], [103.85451200000001, 1.280328]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.854205, 1.278775], [103.854221, 1.278889], [103.854373, 1.278869], [103.854358, 1.278755], [103.854205, 1.278775]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.855091, 1.280326], [103.85516100000001, 1.280431], [103.85541900000001, 1.280259], [103.855377, 1.280188], [103.855332, 1.2801730000000002], [103.855091, 1.280326]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.854478, 1.277045], [103.854529, 1.2770510000000002], [103.85463900000002, 1.277065], [103.85465, 1.276981], [103.854489, 1.276961], [103.854478, 1.277045]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.857304, 1.281909], [103.85781, 1.282333], [103.857708, 1.28165], [103.857475, 1.281798], [103.857304, 1.281909], [103.858122, 1.282684], [103.858389, 1.283033], [103.858722, 1.283472], [103.859226, 1.28274], [103.859307, 1.282605], [103.859058, 1.282228], [103.858742, 1.281729], [103.858419, 1.281222]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853255, 1.283837], [103.853261, 1.284021], [103.85385900000001, 1.284], [103.853853, 1.2838150000000002], [103.853255, 1.283837]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.853356, 1.283004], [103.853372, 1.283325], [103.853375, 1.283393], [103.853595, 1.283382], [103.853927, 1.283366], [103.853909, 1.282991], [103.853791, 1.282997], [103.85379, 1.282982], [103.85342500000002, 1.283], [103.853356, 1.283004]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.858731, 1.281006], [103.858973, 1.281384], [103.859029, 1.281471], [103.859101, 1.281425], [103.858802, 1.28096], [103.858731, 1.281006]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.858355, 1.285184], [103.858473, 1.285463], [103.858409, 1.28505], [103.858355, 1.285184], [103.858538, 1.2854680000000003], [103.85854300000001, 1.2853340000000002], [103.858688, 1.2853340000000002], [103.858752, 1.285243], [103.85857, 1.284916], [103.858484, 1.284937], [103.85853700000001, 1.284975], [103.858484, 1.285045]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.860965, 1.284787], [103.860997, 1.2848940000000002], [103.860965, 1.284787], [103.861118, 1.285304], [103.86113700000001, 1.285523], [103.861128, 1.285805], [103.861299, 1.285811], [103.86131900000001, 1.285511], [103.86127400000001, 1.284927], [103.861256, 1.284854], [103.86122, 1.2847140000000001]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.854152, 1.2788990000000002], [103.854199, 1.279251], [103.854562, 1.279202], [103.854541, 1.279043], [103.854515, 1.27885], [103.854373, 1.278869], [103.854221, 1.278889], [103.854152, 1.2788990000000002]]]]}}]}, {"type": "FeatureCollection", "features": [{"type": "Feature", "properties": {"height": 40.0, "minHeight": 0.0, "color": "red", "roofColor": "red"}, "geometry": {"type": "MultiPolygon", "coordinates": [[[[103.858938, 1.283877], [103.859291, 1.284589], [103.859447, 1.283082], [103.858938, 1.283877], [103.859405, 1.284858], [103.860295, 1.284148], [103.860255, 1.284069], [103.860166, 1.283884], [103.860003, 1.283603], [103.859799, 1.2832910000000002], [103.859651, 1.283113], [103.859517, 1.28298]]]]}}]}]

const controlButtonsSetter = osmb => {
  var controlButtons = document.querySelectorAll('.control button')
  for (var i = 0, il = controlButtons.length; i < il; i++) {
    controlButtons[i].addEventListener('click', function (e) {
      var button = this
      var parentClassList = button.parentNode.classList
      var direction = button.classList.contains('inc') ? 1 : -1
      var increment
      var property

      if (parentClassList.contains('tilt')) {
        property = 'Tilt'
        increment = direction * 10
      }
      if (parentClassList.contains('rotation')) {
        property = 'Rotation'
        increment = direction * 10
      }
      if (parentClassList.contains('zoom')) {
        property = 'Zoom'
        increment = direction * 1
      }
      if (property) {
        osmb['set' + property](osmb['get' + property]() + increment)
      }
    })
  }
}

const initadms3dmap = (
  list, range, osmb, location, coordinatesMid, cityiri, shipList, folder) => {

  for (obj of listGeoJsonAddedToOSMB) {
    obj.destroy()
  }

  proj4.defs('EPSG:3857',
    '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs')
  proj4.defs('WGS84',
    '+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees')
  proj4.defs("EPSG:3414",
		  "+proj=tmerc +lat_0=1.366666666666667 +lon_0=103.8333333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +units=m +no_defs");
  const parsedLowLeft = proj4('EPSG:3857', 'WGS84', [range[0], range[2]])
  const parsedTopRight = proj4('EPSG:3857', 'WGS84', [range[1], range[3]])
  let lowLeft = [], topRight = []
  lowLeft[0] = Math.min(parsedLowLeft[0], parsedTopRight[0])
  lowLeft[1] = Math.min(parsedLowLeft[1], parsedTopRight[1])
  topRight[0] = Math.max(parsedLowLeft[0], parsedTopRight[0])
  topRight[1] = Math.max(parsedLowLeft[1], parsedTopRight[1])

  const position = {}

  position.latitude = coordinatesMid[0]
  position.longitude = coordinatesMid[1]

  osmb.setPosition(position)
  osmb.setZoom(15.7)
  osmb.setTilt(45.0)

  // --- Rendering 3D building models --- //
  console.log('START')
/*
  $.getJSON('/JPS/ADMSHelper',
    {
      listOfIRIs: JSON.stringify(list),
      cityiri,
    },
    function (data) {
      var geojson = data
      var arrayLength = geojson.length
      console.log(data)

      for (var i = 0; i < arrayLength; i++) {

        try {
          listGeoJsonAddedToOSMB.push(osmb.addGeoJSON(geojson[i])) // edit
          console.log(JSON.stringify(geojson[i], null, 4))
        } catch (err) {
          console.log(err.name)
        }
      }
    })
*/
  for (let i = 0; i < buildings.length; i++) {
      listGeoJsonAddedToOSMB.push(osmb.addGeoJSON(buildings[i]))
  }


  // --- Rendering 3D ship models --- //
  function addShips(list) {
    for (ship of list) {
      let geoShip = {
        type: 'FeatureCollection',
        features: [
          {
            type: 'Feature',
            properties: {
              color: 'black',
              roofColor: 'black',
              height: 5,
              minHeight: 0,
            },
            geometry: {
              type: 'Polygon',
              coordinates: [
                [
                  [ship.lon + 0.0001, ship.lat],
                  [ship.lon, ship.lat - 0.0001],
                  [ship.lon - 0.0001, ship.lat],
                  [ship.lon, ship.lat + 0.0001],
                  [ship.lon + 0.0001, ship.lat],
                ],
              ],
            },
          }],
      }
      //listGeoJsonAddedToOSMB.push(osmb.addGeoJSON(geoShip))
      ships.push(osmb.addGeoJSON(geoShip))
    }
  }

  addShips(shipList.collection.items)

  // --- Rendering 3D layer --- //
  let optionWrapperNode = document.getElementById('optionwrapper')
  while (optionWrapperNode.firstChild) {
    optionWrapperNode.removeChild(optionWrapperNode.firstChild)
  }
  makeRadios('optionwrapper', POL_LIST, 'Select a pollutant:')

  var geojson = {
    type: 'FeatureCollection',
    features: [
      {
        type: 'Feature',
        properties: {
          height: 0,
          minHeight: 0,
        },
        geometry: {
          type: 'Polygon',
          coordinates: [//TODO:ã€€LINK THIS TO USER INPUT
            [
              [lowLeft[0], topRight[1]],
              [topRight[0], topRight[1]],
              [topRight[0], lowLeft[1]],
              [lowLeft[0], lowLeft[1]],
              [lowLeft[0], topRight[1]],
            ],
          ],
        },
      }],
  }

  function drawPolution(folder) {

    $.ajax({
      url: '/JPS/AplShips',
      data: {
        folder: folder,
      },
      dataType: 'text',
    }).done(function (shipsResult) {
      let shipsList = JSON.parse(shipsResult)
      let shipsListTransformed = []
      //let src_hk = new proj4.Proj("EPSG:2326")
      let src = new proj4.Proj("EPSG:3414")
      let dst = new proj4.Proj('EPSG:4326')
      let orig = new proj4.Proj('EPSG:3857')
      let regionUP = new proj4.Point(11563323.926, 143305.896);
      let regionD = new proj4.Point(11560879.832, 140107.739);
      let regionUPT = proj4.transform(orig, dst, regionUP)
      let regionDT = proj4.transform(orig, dst, regionD)
      for (ship of shipsList) {
        let shipPt = new proj4.Point(ship.lon, ship.lat);
        let shipT = proj4.transform(src, dst, shipPt)
        //if (shipT.x > regionDT.x && shipT.x < regionUPT.x && shipT.y > regionDT.y && shipT.y < regionUPT.y) {
        	console.log(shipT, shipPt);
          shipsListTransformed.push({'lat':shipT.y, 'lon':shipT.x})
        //}
      }
      for (obj of ships) {
        obj.destroy()
      }
      addShips(shipsListTransformed)
    })

    $('.radiogroup').children('input').first().attr('checked', true)

    getContourMaps('/JPS/ADMSOutputAllForShips', folder).then(dataurls => {
      for (obj of preobjs) {
        obj.destroy()
      }
      const LEGEND_WRAPPER = 'legendwrapper'
      const SLIDER_WRAPPER = 'sliderwrapper'
      let legendWrapperNode = document.getElementById(LEGEND_WRAPPER)
      let sliderWrapperNode = document.getElementById(SLIDER_WRAPPER)
      let idxSrc = 0, idxH = 0, preObj
      let image = dataurls[0][0]
      let thresholds = dataurls[0][1], color = dataurls[0][2]

      while (legendWrapperNode.firstChild) {
        legendWrapperNode.removeChild(legendWrapperNode.firstChild)
      }
      makeLegend(LEGEND_WRAPPER, thresholds, color)

      //  var dataurls = data.dataurls, heights =data.heights
      preObj = osmb.addGeoJSON(geojson,
          {elevation: 0, hasTexture: dataurls[0][0]})
      //listGeoJsonAddedToOSMB.push(preObj) // edit
      preobjs.push(preObj)

      while (sliderWrapperNode.firstChild) {
        sliderWrapperNode.removeChild(sliderWrapperNode.firstChild)
      }

      $('.radiogroup').change(function () {
        let radioValue = $('input[name=\'radio\']:checked').val()
        idxSrc = POL_LIST.indexOf(radioValue)
        thresholds = dataurls[idxH * POL_NUM + idxSrc][1]
        color = dataurls[idxH * POL_NUM + idxSrc][2]
        image = dataurls[idxH * POL_NUM + idxSrc][0]
        for (obj of preobjs) {
          obj.destroy()
        }

        if (preObj) preObj.destroy()

        while (legendWrapperNode.firstChild) {
          legendWrapperNode.removeChild(legendWrapperNode.firstChild)
        }
        makeLegend(LEGEND_WRAPPER, thresholds, color)

        preObj = osmb.addGeoJSON(geojson, {
          elevation: HEIGHT_INTERVAL * (idxH),
          hasTexture: image,
        })
        //listGeoJsonAddedToOSMB.push(preObj) // edit
        preobjs.push(preObj)
      })

      //init at zero position
      makeSlider(SLIDER_WRAPPER, HEIGHT_NUM, function (event, ui) {
        for (obj of preobjs) {
          obj.destroy()
        }
        if (preObj) preObj.destroy()
        idxH = ui.value
        $('#height-show').val(idxH * 10)
        thresholds = dataurls[idxH * POL_NUM + idxSrc][1]
        color = dataurls[idxH * POL_NUM + idxSrc][2]
        image = dataurls[idxH * POL_NUM + idxSrc][0]

        while (legendWrapperNode.firstChild) {
          legendWrapperNode.removeChild(legendWrapperNode.firstChild)
        }
        makeLegend(LEGEND_WRAPPER, thresholds, color)

        preObj = osmb.addGeoJSON(geojson, {
          elevation: HEIGHT_INTERVAL * (idxH),
          hasTexture: image,
        })
        //listGeoJsonAddedToOSMB.push(preObj)
        preobjs.push(preObj)
      })
    }, err => {
      console.log(err)
    })
  }
  function theLoop (counter) {
    if (counter < profiles.length) {
      folder = 'C:\\Users\\LONG01\\Dev\\scenarios\\' + profiles[counter] + '\\JPS_ADMS';
      setTimeout(function () {
        counter++;
        drawPolution(folder);
        theLoop(counter);
      }, 120000);
    }
  }

  folder = 'C:\\Users\\LONG01\\Dev\\scenarios\\' + profiles[0] + '\\JPS_ADMS';
  drawPolution(folder);
  theLoop(1);
 }
